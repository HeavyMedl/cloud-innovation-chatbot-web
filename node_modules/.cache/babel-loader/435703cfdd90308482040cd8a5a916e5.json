{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Error_1 = require(\"./Error\");\n\nvar Guid_1 = require(\"./Guid\");\n\nvar EventSource =\n/** @class */\nfunction () {\n  function EventSource(metadata) {\n    var _this = this;\n\n    this.eventListeners = {};\n    this.isDisposed = false;\n\n    this.OnEvent = function (event) {\n      if (_this.IsDisposed()) {\n        throw new Error_1.ObjectDisposedError(\"EventSource\");\n      }\n\n      if (_this.Metadata) {\n        for (var paramName in _this.Metadata) {\n          if (paramName) {\n            if (event.Metadata) {\n              if (!event.Metadata[paramName]) {\n                event.Metadata[paramName] = _this.Metadata[paramName];\n              }\n            }\n          }\n        }\n      }\n\n      for (var eventId in _this.eventListeners) {\n        if (eventId && _this.eventListeners[eventId]) {\n          _this.eventListeners[eventId](event);\n        }\n      }\n    };\n\n    this.Attach = function (onEventCallback) {\n      var id = Guid_1.CreateNoDashGuid();\n      _this.eventListeners[id] = onEventCallback;\n      return {\n        Detach: function () {\n          delete _this.eventListeners[id];\n        }\n      };\n    };\n\n    this.AttachListener = function (listener) {\n      return _this.Attach(listener.OnEvent);\n    };\n\n    this.IsDisposed = function () {\n      return _this.isDisposed;\n    };\n\n    this.Dispose = function () {\n      _this.eventListeners = null;\n      _this.isDisposed = true;\n    };\n\n    this.metadata = metadata;\n  }\n\n  Object.defineProperty(EventSource.prototype, \"Metadata\", {\n    get: function () {\n      return this.metadata;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return EventSource;\n}();\n\nexports.EventSource = EventSource;","map":null,"metadata":{},"sourceType":"script"}