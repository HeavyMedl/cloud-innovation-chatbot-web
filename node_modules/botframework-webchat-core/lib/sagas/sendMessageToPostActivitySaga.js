"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = _callee;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _effects = require("redux-saga/effects");

var _whileConnected = _interopRequireDefault(require("./effects/whileConnected"));

var _sendMessage = require("../actions/sendMessage");

var _postActivity = _interopRequireDefault(require("../actions/postActivity"));

var _marked =
/*#__PURE__*/
_regenerator["default"].mark(_callee),
    _marked2 =
/*#__PURE__*/
_regenerator["default"].mark(sendMessageToPostActivity),
    _marked3 =
/*#__PURE__*/
_regenerator["default"].mark(postActivityWithMessage);

function _callee() {
  return _regenerator["default"].wrap(function _callee$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          _context.next = 2;
          return (0, _whileConnected["default"])(sendMessageToPostActivity);

        case 2:
        case "end":
          return _context.stop();
      }
    }
  }, _marked);
}

function sendMessageToPostActivity() {
  return _regenerator["default"].wrap(function sendMessageToPostActivity$(_context2) {
    while (1) {
      switch (_context2.prev = _context2.next) {
        case 0:
          _context2.next = 2;
          return (0, _effects.takeEvery)(function (_ref) {
            var payload = _ref.payload,
                type = _ref.type;
            return type === _sendMessage.SEND_MESSAGE && payload.text;
          }, postActivityWithMessage);

        case 2:
        case "end":
          return _context2.stop();
      }
    }
  }, _marked2);
}

function postActivityWithMessage(_ref2) {
  var _ref2$payload, method, text;

  return _regenerator["default"].wrap(function postActivityWithMessage$(_context3) {
    while (1) {
      switch (_context3.prev = _context3.next) {
        case 0:
          _ref2$payload = _ref2.payload, method = _ref2$payload.method, text = _ref2$payload.text;
          _context3.next = 3;
          return (0, _effects.put)((0, _postActivity["default"])({
            text: text,
            textFormat: 'plain',
            type: 'message'
          }, method));

        case 3:
        case "end":
          return _context3.stop();
      }
    }
  }, _marked3);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zYWdhcy9zZW5kTWVzc2FnZVRvUG9zdEFjdGl2aXR5U2FnYS5qcyJdLCJuYW1lcyI6WyJzZW5kTWVzc2FnZVRvUG9zdEFjdGl2aXR5IiwicG9zdEFjdGl2aXR5V2l0aE1lc3NhZ2UiLCJwYXlsb2FkIiwidHlwZSIsIlNFTkRfTUVTU0FHRSIsInRleHQiLCJtZXRob2QiLCJ0ZXh0Rm9ybWF0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUtBOztBQUVBOztBQUNBOzs7Ozs7OzZCQU1VQSx5Qjs7OzZCQU9BQyx1Qjs7QUFYSztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDYixpQkFBTSxnQ0FBZUQseUJBQWYsQ0FBTjs7QUFEYTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFJZixTQUFVQSx5QkFBVjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDRSxpQkFBTSx3QkFBVTtBQUFBLGdCQUFHRSxPQUFILFFBQUdBLE9BQUg7QUFBQSxnQkFBWUMsSUFBWixRQUFZQSxJQUFaO0FBQUEsbUJBQ2RBLElBQUksS0FBS0MseUJBQVQsSUFDR0YsT0FBTyxDQUFDRyxJQUZHO0FBQUEsV0FBVixFQUdISix1QkFIRyxDQUFOOztBQURGO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOztBQU9BLFNBQVVBLHVCQUFWO0FBQUE7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxnQ0FBb0NDLE9BQXBDLEVBQStDSSxNQUEvQyxpQkFBK0NBLE1BQS9DLEVBQXVERCxJQUF2RCxpQkFBdURBLElBQXZEO0FBQUE7QUFDRSxpQkFBTSxrQkFBSSw4QkFBYTtBQUNyQkEsWUFBQUEsSUFBSSxFQUFKQSxJQURxQjtBQUVyQkUsWUFBQUEsVUFBVSxFQUFFLE9BRlM7QUFHckJKLFlBQUFBLElBQUksRUFBRTtBQUhlLFdBQWIsRUFJUEcsTUFKTyxDQUFKLENBQU47O0FBREY7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBwdXQsXG4gIHRha2VFdmVyeVxufSBmcm9tICdyZWR1eC1zYWdhL2VmZmVjdHMnO1xuXG5pbXBvcnQgd2hpbGVDb25uZWN0ZWQgZnJvbSAnLi9lZmZlY3RzL3doaWxlQ29ubmVjdGVkJztcblxuaW1wb3J0IHsgU0VORF9NRVNTQUdFIH0gZnJvbSAnLi4vYWN0aW9ucy9zZW5kTWVzc2FnZSc7XG5pbXBvcnQgcG9zdEFjdGl2aXR5IGZyb20gJy4uL2FjdGlvbnMvcG9zdEFjdGl2aXR5JztcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24qICgpIHtcbiAgeWllbGQgd2hpbGVDb25uZWN0ZWQoc2VuZE1lc3NhZ2VUb1Bvc3RBY3Rpdml0eSk7XG59XG5cbmZ1bmN0aW9uKiBzZW5kTWVzc2FnZVRvUG9zdEFjdGl2aXR5KCkge1xuICB5aWVsZCB0YWtlRXZlcnkoKHsgcGF5bG9hZCwgdHlwZSB9KSA9PiAoXG4gICAgdHlwZSA9PT0gU0VORF9NRVNTQUdFXG4gICAgJiYgcGF5bG9hZC50ZXh0XG4gICksIHBvc3RBY3Rpdml0eVdpdGhNZXNzYWdlKTtcbn1cblxuZnVuY3Rpb24qIHBvc3RBY3Rpdml0eVdpdGhNZXNzYWdlKHsgcGF5bG9hZDogeyBtZXRob2QsIHRleHQgfSB9KSB7XG4gIHlpZWxkIHB1dChwb3N0QWN0aXZpdHkoe1xuICAgIHRleHQsXG4gICAgdGV4dEZvcm1hdDogJ3BsYWluJyxcbiAgICB0eXBlOiAnbWVzc2FnZSdcbiAgfSwgbWV0aG9kKSk7XG59XG4iXX0=