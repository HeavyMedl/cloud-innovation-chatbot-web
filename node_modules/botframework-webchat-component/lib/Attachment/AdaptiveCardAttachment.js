"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _memoizeOne = _interopRequireDefault(require("memoize-one"));

var _react = _interopRequireDefault(require("react"));

var _AdaptiveCardRenderer = _interopRequireDefault(require("./AdaptiveCardRenderer"));

var _adaptivecards = require("adaptivecards");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function stripSubmitAction(card) {
  if (!card.actions) {
    return card;
  } // Filter out HTTP action buttons


  var nextActions = card.actions.filter(function (action) {
    return action.type !== 'Action.Submit';
  }).map(function (action) {
    return action.type === 'Action.ShowCard' ? _objectSpread({}, action, {
      card: stripSubmitAction(action.card)
    }) : action;
  });
  return _objectSpread({}, card, {
    nextActions: nextActions
  });
}

var AdaptiveCardAttachment =
/*#__PURE__*/
function (_React$Component) {
  _inherits(AdaptiveCardAttachment, _React$Component);

  function AdaptiveCardAttachment(props) {
    var _this;

    _classCallCheck(this, AdaptiveCardAttachment);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(AdaptiveCardAttachment).call(this, props));
    _this.createAdaptiveCard = (0, _memoizeOne.default)(function (adaptiveCards, content, renderMarkdown) {
      var card = new adaptiveCards.AdaptiveCard();
      var errors = []; // TODO: [P3] Move from "onParseError" to "card.parse(json, errors)"

      adaptiveCards.AdaptiveCard.onParseError = function (error) {
        return errors.push(error);
      };

      card.parse(stripSubmitAction(_objectSpread({
        version: '1.0'
      }, content)));
      _adaptivecards.AdaptiveCard.onParseError = null;
      return {
        card: card,
        errors: errors
      };
    });
    return _this;
  }

  _createClass(AdaptiveCardAttachment, [{
    key: "render",
    value: function render() {
      var _this$props = this.props,
          adaptiveCards = _this$props.adaptiveCards,
          attachment = _this$props.attachment,
          renderMarkdown = _this$props.renderMarkdown;

      var _this$createAdaptiveC = this.createAdaptiveCard(adaptiveCards, attachment.content, renderMarkdown),
          card = _this$createAdaptiveC.card;

      return _react.default.createElement(_AdaptiveCardRenderer.default, {
        adaptiveCard: card
      });
    }
  }]);

  return AdaptiveCardAttachment;
}(_react.default.Component);

exports.default = AdaptiveCardAttachment;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9BdHRhY2htZW50L0FkYXB0aXZlQ2FyZEF0dGFjaG1lbnQuanMiXSwibmFtZXMiOlsic3RyaXBTdWJtaXRBY3Rpb24iLCJjYXJkIiwiYWN0aW9ucyIsIm5leHRBY3Rpb25zIiwiZmlsdGVyIiwiYWN0aW9uIiwidHlwZSIsIm1hcCIsIkFkYXB0aXZlQ2FyZEF0dGFjaG1lbnQiLCJwcm9wcyIsImNyZWF0ZUFkYXB0aXZlQ2FyZCIsImFkYXB0aXZlQ2FyZHMiLCJjb250ZW50IiwicmVuZGVyTWFya2Rvd24iLCJBZGFwdGl2ZUNhcmQiLCJlcnJvcnMiLCJvblBhcnNlRXJyb3IiLCJlcnJvciIsInB1c2giLCJwYXJzZSIsInZlcnNpb24iLCJhdHRhY2htZW50IiwiUmVhY3QiLCJDb21wb25lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFFQTs7QUFFQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxTQUFTQSxpQkFBVCxDQUEyQkMsSUFBM0IsRUFBaUM7QUFDL0IsTUFBSSxDQUFDQSxJQUFJLENBQUNDLE9BQVYsRUFBbUI7QUFDakIsV0FBT0QsSUFBUDtBQUNELEdBSDhCLENBSy9COzs7QUFDQSxNQUFNRSxXQUFXLEdBQUdGLElBQUksQ0FBQ0MsT0FBTCxDQUNqQkUsTUFEaUIsQ0FDVixVQUFBQyxNQUFNO0FBQUEsV0FBSUEsTUFBTSxDQUFDQyxJQUFQLEtBQWdCLGVBQXBCO0FBQUEsR0FESSxFQUVqQkMsR0FGaUIsQ0FFYixVQUFBRixNQUFNO0FBQUEsV0FDVEEsTUFBTSxDQUFDQyxJQUFQLEtBQWdCLGlCQUFoQixxQkFDT0QsTUFEUDtBQUNlSixNQUFBQSxJQUFJLEVBQUVELGlCQUFpQixDQUFDSyxNQUFNLENBQUNKLElBQVI7QUFEdEMsU0FHRUksTUFKTztBQUFBLEdBRk8sQ0FBcEI7QUFTQSwyQkFBWUosSUFBWjtBQUFrQkUsSUFBQUEsV0FBVyxFQUFYQTtBQUFsQjtBQUNEOztJQUVvQkssc0I7Ozs7O0FBQ25CLGtDQUFZQyxLQUFaLEVBQW1CO0FBQUE7O0FBQUE7O0FBQ2pCLGdHQUFNQSxLQUFOO0FBRUEsVUFBS0Msa0JBQUwsR0FBMEIseUJBQVEsVUFBQ0MsYUFBRCxFQUFnQkMsT0FBaEIsRUFBeUJDLGNBQXpCLEVBQTRDO0FBQzVFLFVBQU1aLElBQUksR0FBRyxJQUFJVSxhQUFhLENBQUNHLFlBQWxCLEVBQWI7QUFDQSxVQUFNQyxNQUFNLEdBQUcsRUFBZixDQUY0RSxDQUk1RTs7QUFDQUosTUFBQUEsYUFBYSxDQUFDRyxZQUFkLENBQTJCRSxZQUEzQixHQUEwQyxVQUFBQyxLQUFLO0FBQUEsZUFBSUYsTUFBTSxDQUFDRyxJQUFQLENBQVlELEtBQVosQ0FBSjtBQUFBLE9BQS9DOztBQUVBaEIsTUFBQUEsSUFBSSxDQUFDa0IsS0FBTCxDQUFXbkIsaUJBQWlCO0FBQzFCb0IsUUFBQUEsT0FBTyxFQUFFO0FBRGlCLFNBRXZCUixPQUZ1QixFQUE1QjtBQUtBRSxrQ0FBYUUsWUFBYixHQUE0QixJQUE1QjtBQUVBLGFBQU87QUFDTGYsUUFBQUEsSUFBSSxFQUFKQSxJQURLO0FBRUxjLFFBQUFBLE1BQU0sRUFBTkE7QUFGSyxPQUFQO0FBSUQsS0FsQnlCLENBQTFCO0FBSGlCO0FBc0JsQjs7Ozs2QkFFUTtBQUFBLHdCQUMwRCxJQUQxRCxDQUNDTixLQUREO0FBQUEsVUFDVUUsYUFEVixlQUNVQSxhQURWO0FBQUEsVUFDeUJVLFVBRHpCLGVBQ3lCQSxVQUR6QjtBQUFBLFVBQ3FDUixjQURyQyxlQUNxQ0EsY0FEckM7O0FBQUEsa0NBRVUsS0FBS0gsa0JBQUwsQ0FBd0JDLGFBQXhCLEVBQXVDVSxVQUFVLENBQUNULE9BQWxELEVBQTJEQyxjQUEzRCxDQUZWO0FBQUEsVUFFQ1osSUFGRCx5QkFFQ0EsSUFGRDs7QUFJUCxhQUNFLDZCQUFDLDZCQUFEO0FBQXNCLFFBQUEsWUFBWSxFQUFHQTtBQUFyQyxRQURGO0FBR0Q7Ozs7RUFoQ2lEcUIsZUFBTUMsUyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtZW1vaXplIGZyb20gJ21lbW9pemUtb25lJztcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCBBZGFwdGl2ZUNhcmRSZW5kZXJlciBmcm9tICcuL0FkYXB0aXZlQ2FyZFJlbmRlcmVyJztcblxuaW1wb3J0IHsgQWRhcHRpdmVDYXJkIH0gZnJvbSAnYWRhcHRpdmVjYXJkcyc7XG5cbmZ1bmN0aW9uIHN0cmlwU3VibWl0QWN0aW9uKGNhcmQpIHtcbiAgaWYgKCFjYXJkLmFjdGlvbnMpIHtcbiAgICByZXR1cm4gY2FyZDtcbiAgfVxuXG4gIC8vIEZpbHRlciBvdXQgSFRUUCBhY3Rpb24gYnV0dG9uc1xuICBjb25zdCBuZXh0QWN0aW9ucyA9IGNhcmQuYWN0aW9uc1xuICAgIC5maWx0ZXIoYWN0aW9uID0+IGFjdGlvbi50eXBlICE9PSAnQWN0aW9uLlN1Ym1pdCcpXG4gICAgLm1hcChhY3Rpb24gPT5cbiAgICAgIGFjdGlvbi50eXBlID09PSAnQWN0aW9uLlNob3dDYXJkJyA/XG4gICAgICAgIHsgLi4uYWN0aW9uLCBjYXJkOiBzdHJpcFN1Ym1pdEFjdGlvbihhY3Rpb24uY2FyZCkgfVxuICAgICAgOlxuICAgICAgICBhY3Rpb25cbiAgICApO1xuXG4gIHJldHVybiB7IC4uLmNhcmQsIG5leHRBY3Rpb25zIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFkYXB0aXZlQ2FyZEF0dGFjaG1lbnQgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIHRoaXMuY3JlYXRlQWRhcHRpdmVDYXJkID0gbWVtb2l6ZSgoYWRhcHRpdmVDYXJkcywgY29udGVudCwgcmVuZGVyTWFya2Rvd24pID0+IHtcbiAgICAgIGNvbnN0IGNhcmQgPSBuZXcgYWRhcHRpdmVDYXJkcy5BZGFwdGl2ZUNhcmQoKTtcbiAgICAgIGNvbnN0IGVycm9ycyA9IFtdO1xuXG4gICAgICAvLyBUT0RPOiBbUDNdIE1vdmUgZnJvbSBcIm9uUGFyc2VFcnJvclwiIHRvIFwiY2FyZC5wYXJzZShqc29uLCBlcnJvcnMpXCJcbiAgICAgIGFkYXB0aXZlQ2FyZHMuQWRhcHRpdmVDYXJkLm9uUGFyc2VFcnJvciA9IGVycm9yID0+IGVycm9ycy5wdXNoKGVycm9yKTtcblxuICAgICAgY2FyZC5wYXJzZShzdHJpcFN1Ym1pdEFjdGlvbih7XG4gICAgICAgIHZlcnNpb246ICcxLjAnLFxuICAgICAgICAuLi5jb250ZW50XG4gICAgICB9KSk7XG5cbiAgICAgIEFkYXB0aXZlQ2FyZC5vblBhcnNlRXJyb3IgPSBudWxsO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjYXJkLFxuICAgICAgICBlcnJvcnNcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBwcm9wczogeyBhZGFwdGl2ZUNhcmRzLCBhdHRhY2htZW50LCByZW5kZXJNYXJrZG93biB9IH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgY2FyZCB9ID0gdGhpcy5jcmVhdGVBZGFwdGl2ZUNhcmQoYWRhcHRpdmVDYXJkcywgYXR0YWNobWVudC5jb250ZW50LCByZW5kZXJNYXJrZG93bik7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPEFkYXB0aXZlQ2FyZFJlbmRlcmVyIGFkYXB0aXZlQ2FyZD17IGNhcmQgfSAvPlxuICAgICk7XG4gIH1cbn1cbiJdfQ==