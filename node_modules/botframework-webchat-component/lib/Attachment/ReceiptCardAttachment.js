"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _memoizeOne = _interopRequireDefault(require("memoize-one"));

var _react = _interopRequireDefault(require("react"));

var _AdaptiveCardBuilder = require("../Utils/AdaptiveCardBuilder");

var _Localize = require("../Localization/Localize");

var _AdaptiveCardRenderer = _interopRequireDefault(require("./AdaptiveCardRenderer"));

var _connectToWebChat = _interopRequireDefault(require("../connectToWebChat"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function nullOrUndefined(obj) {
  return obj === null || typeof obj === 'undefined';
}

var ReceiptCardAttachment =
/*#__PURE__*/
function (_React$Component) {
  _inherits(ReceiptCardAttachment, _React$Component);

  function ReceiptCardAttachment(props) {
    var _this;

    _classCallCheck(this, ReceiptCardAttachment);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(ReceiptCardAttachment).call(this, props));
    _this.buildCard = (0, _memoizeOne.default)(function (adaptiveCards, content, language) {
      var builder = new _AdaptiveCardBuilder.AdaptiveCardBuilder(adaptiveCards);
      var HorizontalAlignment = adaptiveCards.HorizontalAlignment,
          TextSize = adaptiveCards.TextSize,
          TextWeight = adaptiveCards.TextWeight;
      builder.addTextBlock(content.title, {
        size: TextSize.Medium,
        weight: TextWeight.Bolder
      });
      var columns = builder.addColumnSet([75, 25]); // tslint:disable-next-line:no-unused-expression

      content.facts && content.facts.map(function (fact) {
        builder.addTextBlock(fact.key, {
          size: TextSize.Medium
        }, columns[0]);
        builder.addTextBlock(fact.value, {
          size: TextSize.Medium,
          horizontalAlignment: HorizontalAlignment.Right
        }, columns[1]);
      }); // tslint:disable-next-line:no-unused-expression

      content.items && content.items.map(function (item) {
        if (item.image) {
          var _columns = builder.addColumnSet([15, 75, 10]);

          builder.addImage(item.image.url, _columns[0], item.image.tap);
          builder.addTextBlock(item.title, {
            size: TextSize.Medium,
            weight: TextWeight.Bolder,
            wrap: true
          }, _columns[1]);
          builder.addTextBlock(item.subtitle, {
            size: TextSize.Medium,
            wrap: true
          }, _columns[1]);
          builder.addTextBlock(item.price, {
            horizontalAlignment: HorizontalAlignment.Right
          }, _columns[2]);
        } else {
          var _columns2 = builder.addColumnSet([75, 25]);

          builder.addTextBlock(item.title, {
            size: TextSize.Medium,
            weight: TextWeight.Bolder,
            wrap: true
          }, _columns2[0]);
          builder.addTextBlock(item.subtitle, {
            size: TextSize.Medium,
            wrap: true
          }, _columns2[0]);
          builder.addTextBlock(item.price, {
            horizontalAlignment: HorizontalAlignment.Right
          }, _columns2[1]);
        }
      });

      if (!nullOrUndefined(content.vat)) {
        var vatCol = builder.addColumnSet([75, 25]);
        builder.addTextBlock((0, _Localize.localize)('VAT', language), {
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, vatCol[0]);
        builder.addTextBlock(content.vat, {
          horizontalAlignment: HorizontalAlignment.Right
        }, vatCol[1]);
      }

      if (!nullOrUndefined(content.tax)) {
        var taxCol = builder.addColumnSet([75, 25]);
        builder.addTextBlock((0, _Localize.localize)('Tax', language), {
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, taxCol[0]);
        builder.addTextBlock(content.tax, {
          horizontalAlignment: HorizontalAlignment.Right
        }, taxCol[1]);
      }

      if (!nullOrUndefined(content.total)) {
        var totalCol = builder.addColumnSet([75, 25]);
        builder.addTextBlock((0, _Localize.localize)('Total', language), {
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, totalCol[0]);
        builder.addTextBlock(content.total, {
          horizontalAlignment: HorizontalAlignment.Right,
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, totalCol[1]);
      }

      builder.addButtons(content.buttons);
      return builder.card;
    });
    return _this;
  }

  _createClass(ReceiptCardAttachment, [{
    key: "render",
    value: function render() {
      var _this$props = this.props,
          adaptiveCards = _this$props.adaptiveCards,
          _this$props$attachmen = _this$props.attachment;
      _this$props$attachmen = _this$props$attachmen === void 0 ? {} : _this$props$attachmen;
      var content = _this$props$attachmen.content,
          language = _this$props.language;
      return _react.default.createElement(_AdaptiveCardRenderer.default, {
        adaptiveCard: content && this.buildCard(adaptiveCards, content, language),
        tapAction: content && content.tap
      });
    }
  }]);

  return ReceiptCardAttachment;
}(_react.default.Component);

var _default = (0, _connectToWebChat.default)(function (_ref) {
  var language = _ref.language;
  return {
    language: language
  };
})(ReceiptCardAttachment);

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9BdHRhY2htZW50L1JlY2VpcHRDYXJkQXR0YWNobWVudC5qcyJdLCJuYW1lcyI6WyJudWxsT3JVbmRlZmluZWQiLCJvYmoiLCJSZWNlaXB0Q2FyZEF0dGFjaG1lbnQiLCJwcm9wcyIsImJ1aWxkQ2FyZCIsImFkYXB0aXZlQ2FyZHMiLCJjb250ZW50IiwibGFuZ3VhZ2UiLCJidWlsZGVyIiwiQWRhcHRpdmVDYXJkQnVpbGRlciIsIkhvcml6b250YWxBbGlnbm1lbnQiLCJUZXh0U2l6ZSIsIlRleHRXZWlnaHQiLCJhZGRUZXh0QmxvY2siLCJ0aXRsZSIsInNpemUiLCJNZWRpdW0iLCJ3ZWlnaHQiLCJCb2xkZXIiLCJjb2x1bW5zIiwiYWRkQ29sdW1uU2V0IiwiZmFjdHMiLCJtYXAiLCJmYWN0Iiwia2V5IiwidmFsdWUiLCJob3Jpem9udGFsQWxpZ25tZW50IiwiUmlnaHQiLCJpdGVtcyIsIml0ZW0iLCJpbWFnZSIsImFkZEltYWdlIiwidXJsIiwidGFwIiwid3JhcCIsInN1YnRpdGxlIiwicHJpY2UiLCJ2YXQiLCJ2YXRDb2wiLCJ0YXgiLCJ0YXhDb2wiLCJ0b3RhbCIsInRvdGFsQ29sIiwiYWRkQnV0dG9ucyIsImJ1dHRvbnMiLCJjYXJkIiwiYXR0YWNobWVudCIsIlJlYWN0IiwiQ29tcG9uZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxTQUFTQSxlQUFULENBQXlCQyxHQUF6QixFQUE4QjtBQUM1QixTQUFPQSxHQUFHLEtBQUssSUFBUixJQUFnQixPQUFPQSxHQUFQLEtBQWUsV0FBdEM7QUFDRDs7SUFFS0MscUI7Ozs7O0FBQ0osaUNBQVlDLEtBQVosRUFBbUI7QUFBQTs7QUFBQTs7QUFDakIsK0ZBQU1BLEtBQU47QUFFQSxVQUFLQyxTQUFMLEdBQWlCLHlCQUFRLFVBQUNDLGFBQUQsRUFBZ0JDLE9BQWhCLEVBQXlCQyxRQUF6QixF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QlAsT0FBTyxDQUFDbUMsS0FBN0IsRUFBb0M7QUFBRWYsVUFBQUEsbUJBQW1CLEVBQUVoQixtQkFBbUIsQ0FBQ2lCLEtBQTNDO0FBQWtEWixVQUFBQSxJQUFJLEVBQUVKLFFBQVEsQ0FBQ0ssTUFBakU7QUFBeUVDLFVBQUFBLE1BQU0sRUFBRUwsVUFBVSxDQUFDTTtBQUE1RixTQUFwQyxFQUEwSXdCLFFBQVEsQ0FBQyxDQUFELENBQWxKO0FBQ0Q7O0FBRURsQyxNQUFBQSxPQUFPLENBQUNtQyxVQUFSLENBQW1CckMsT0FBTyxDQUFDc0MsT0FBM0I7QUFFQSxhQUFPcEMsT0FBTyxDQUFDcUMsSUFBZjtBQUNELEtBeERnQixDQUFqQjtBQUhpQjtBQTREbEI7Ozs7NkJBRVE7QUFBQSx3QkFLSCxLQUFLMUMsS0FMRjtBQUFBLFVBRUxFLGFBRkssZUFFTEEsYUFGSztBQUFBLDhDQUdMeUMsVUFISztBQUFBLGlFQUdxQixFQUhyQjtBQUFBLFVBR1N4QyxPQUhULHlCQUdTQSxPQUhUO0FBQUEsVUFJTEMsUUFKSyxlQUlMQSxRQUpLO0FBT1AsYUFDRSw2QkFBQyw2QkFBRDtBQUNFLFFBQUEsWUFBWSxFQUFHRCxPQUFPLElBQUksS0FBS0YsU0FBTCxDQUFlQyxhQUFmLEVBQThCQyxPQUE5QixFQUF1Q0MsUUFBdkMsQ0FENUI7QUFFRSxRQUFBLFNBQVMsRUFBR0QsT0FBTyxJQUFJQSxPQUFPLENBQUMyQjtBQUZqQyxRQURGO0FBTUQ7Ozs7RUE1RWlDYyxlQUFNQyxTOztlQStFM0IsK0JBQ2I7QUFBQSxNQUFHekMsUUFBSCxRQUFHQSxRQUFIO0FBQUEsU0FBbUI7QUFBRUEsSUFBQUEsUUFBUSxFQUFSQTtBQUFGLEdBQW5CO0FBQUEsQ0FEYSxFQUViTCxxQkFGYSxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1lbW9pemUgZnJvbSAnbWVtb2l6ZS1vbmUnO1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHsgQWRhcHRpdmVDYXJkQnVpbGRlciB9IGZyb20gJy4uL1V0aWxzL0FkYXB0aXZlQ2FyZEJ1aWxkZXInO1xuaW1wb3J0IHsgbG9jYWxpemUgfSBmcm9tICcuLi9Mb2NhbGl6YXRpb24vTG9jYWxpemUnO1xuaW1wb3J0IEFkYXB0aXZlQ2FyZFJlbmRlcmVyIGZyb20gJy4vQWRhcHRpdmVDYXJkUmVuZGVyZXInO1xuaW1wb3J0IGNvbm5lY3RUb1dlYkNoYXQgZnJvbSAnLi4vY29ubmVjdFRvV2ViQ2hhdCc7XG5cbmZ1bmN0aW9uIG51bGxPclVuZGVmaW5lZChvYmopIHtcbiAgcmV0dXJuIG9iaiA9PT0gbnVsbCB8fCB0eXBlb2Ygb2JqID09PSAndW5kZWZpbmVkJztcbn1cblxuY2xhc3MgUmVjZWlwdENhcmRBdHRhY2htZW50IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICB0aGlzLmJ1aWxkQ2FyZCA9IG1lbW9pemUoKGFkYXB0aXZlQ2FyZHMsIGNvbnRlbnQsIGxhbmd1YWdlKSA9PiB7XG4gICAgICBjb25zdCBidWlsZGVyID0gbmV3IEFkYXB0aXZlQ2FyZEJ1aWxkZXIoYWRhcHRpdmVDYXJkcyk7XG4gICAgICBjb25zdCB7IEhvcml6b250YWxBbGlnbm1lbnQsIFRleHRTaXplLCBUZXh0V2VpZ2h0IH0gPSBhZGFwdGl2ZUNhcmRzO1xuXG4gICAgICBidWlsZGVyLmFkZFRleHRCbG9jayhjb250ZW50LnRpdGxlLCB7IHNpemU6IFRleHRTaXplLk1lZGl1bSwgd2VpZ2h0OiBUZXh0V2VpZ2h0LkJvbGRlciB9KTtcblxuICAgICAgY29uc3QgY29sdW1ucyA9IGJ1aWxkZXIuYWRkQ29sdW1uU2V0KFs3NSwgMjVdKTtcblxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXVudXNlZC1leHByZXNzaW9uXG4gICAgICBjb250ZW50LmZhY3RzICYmIGNvbnRlbnQuZmFjdHMubWFwKGZhY3QgPT4ge1xuICAgICAgICBidWlsZGVyLmFkZFRleHRCbG9jayhmYWN0LmtleSwgeyBzaXplOiBUZXh0U2l6ZS5NZWRpdW0gfSwgY29sdW1uc1swXSk7XG4gICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKGZhY3QudmFsdWUsIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCBob3Jpem9udGFsQWxpZ25tZW50OiBIb3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0IH0sIGNvbHVtbnNbMV0pO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby11bnVzZWQtZXhwcmVzc2lvblxuICAgICAgY29udGVudC5pdGVtcyAmJiBjb250ZW50Lml0ZW1zLm1hcChpdGVtID0+IHtcbiAgICAgICAgaWYgKGl0ZW0uaW1hZ2UpIHtcbiAgICAgICAgICBjb25zdCBjb2x1bW5zID0gYnVpbGRlci5hZGRDb2x1bW5TZXQoWzE1LCA3NSwgMTBdKTtcblxuICAgICAgICAgIGJ1aWxkZXIuYWRkSW1hZ2UoaXRlbS5pbWFnZS51cmwsIGNvbHVtbnNbMF0sIGl0ZW0uaW1hZ2UudGFwKTtcbiAgICAgICAgICBidWlsZGVyLmFkZFRleHRCbG9jayhpdGVtLnRpdGxlLCB7IHNpemU6IFRleHRTaXplLk1lZGl1bSwgd2VpZ2h0OiBUZXh0V2VpZ2h0LkJvbGRlciwgd3JhcDogdHJ1ZSB9LCBjb2x1bW5zWzFdKTtcbiAgICAgICAgICBidWlsZGVyLmFkZFRleHRCbG9jayhpdGVtLnN1YnRpdGxlLCB7IHNpemU6IFRleHRTaXplLk1lZGl1bSwgd3JhcDogdHJ1ZSB9LCBjb2x1bW5zWzFdKTtcbiAgICAgICAgICBidWlsZGVyLmFkZFRleHRCbG9jayhpdGVtLnByaWNlLCB7IGhvcml6b250YWxBbGlnbm1lbnQ6IEhvcml6b250YWxBbGlnbm1lbnQuUmlnaHQgfSwgY29sdW1uc1syXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgY29sdW1ucyA9IGJ1aWxkZXIuYWRkQ29sdW1uU2V0KFs3NSwgMjVdKTtcblxuICAgICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKGl0ZW0udGl0bGUsIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCB3ZWlnaHQ6IFRleHRXZWlnaHQuQm9sZGVyLCB3cmFwOiB0cnVlIH0sIGNvbHVtbnNbMF0pO1xuICAgICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKGl0ZW0uc3VidGl0bGUsIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCB3cmFwOiB0cnVlIH0sIGNvbHVtbnNbMF0pO1xuICAgICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKGl0ZW0ucHJpY2UsIHsgaG9yaXpvbnRhbEFsaWdubWVudDogSG9yaXpvbnRhbEFsaWdubWVudC5SaWdodCB9LCBjb2x1bW5zWzFdKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmICghbnVsbE9yVW5kZWZpbmVkKGNvbnRlbnQudmF0KSkge1xuICAgICAgICBjb25zdCB2YXRDb2wgPSBidWlsZGVyLmFkZENvbHVtblNldChbNzUsIDI1XSk7XG5cbiAgICAgICAgYnVpbGRlci5hZGRUZXh0QmxvY2sobG9jYWxpemUoJ1ZBVCcsIGxhbmd1YWdlKSwgeyBzaXplOiBUZXh0U2l6ZS5NZWRpdW0sIHdlaWdodDogVGV4dFdlaWdodC5Cb2xkZXIgfSwgdmF0Q29sWzBdKTtcbiAgICAgICAgYnVpbGRlci5hZGRUZXh0QmxvY2soY29udGVudC52YXQsIHsgaG9yaXpvbnRhbEFsaWdubWVudDogSG9yaXpvbnRhbEFsaWdubWVudC5SaWdodCB9LCB2YXRDb2xbMV0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoIW51bGxPclVuZGVmaW5lZChjb250ZW50LnRheCkpIHtcbiAgICAgICAgY29uc3QgdGF4Q29sID0gYnVpbGRlci5hZGRDb2x1bW5TZXQoWzc1LCAyNV0pO1xuXG4gICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKGxvY2FsaXplKCdUYXgnLCBsYW5ndWFnZSksIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCB3ZWlnaHQ6IFRleHRXZWlnaHQuQm9sZGVyIH0sIHRheENvbFswXSk7XG4gICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKGNvbnRlbnQudGF4LCB7IGhvcml6b250YWxBbGlnbm1lbnQ6IEhvcml6b250YWxBbGlnbm1lbnQuUmlnaHQgfSwgdGF4Q29sWzFdKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFudWxsT3JVbmRlZmluZWQoY29udGVudC50b3RhbCkpIHtcbiAgICAgICAgY29uc3QgdG90YWxDb2wgPSBidWlsZGVyLmFkZENvbHVtblNldChbNzUsIDI1XSk7XG5cbiAgICAgICAgYnVpbGRlci5hZGRUZXh0QmxvY2sobG9jYWxpemUoJ1RvdGFsJywgbGFuZ3VhZ2UpLCB7IHNpemU6IFRleHRTaXplLk1lZGl1bSwgd2VpZ2h0OiBUZXh0V2VpZ2h0LkJvbGRlciB9LCB0b3RhbENvbFswXSk7XG4gICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKGNvbnRlbnQudG90YWwsIHsgaG9yaXpvbnRhbEFsaWdubWVudDogSG9yaXpvbnRhbEFsaWdubWVudC5SaWdodCwgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCB3ZWlnaHQ6IFRleHRXZWlnaHQuQm9sZGVyIH0sIHRvdGFsQ29sWzFdKTtcbiAgICAgIH1cblxuICAgICAgYnVpbGRlci5hZGRCdXR0b25zKGNvbnRlbnQuYnV0dG9ucyk7XG5cbiAgICAgIHJldHVybiBidWlsZGVyLmNhcmQ7XG4gICAgfSk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge1xuICAgICAgYWRhcHRpdmVDYXJkcyxcbiAgICAgIGF0dGFjaG1lbnQ6IHsgY29udGVudCB9ID0ge30sXG4gICAgICBsYW5ndWFnZVxuICAgIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxBZGFwdGl2ZUNhcmRSZW5kZXJlclxuICAgICAgICBhZGFwdGl2ZUNhcmQ9eyBjb250ZW50ICYmIHRoaXMuYnVpbGRDYXJkKGFkYXB0aXZlQ2FyZHMsIGNvbnRlbnQsIGxhbmd1YWdlKSB9XG4gICAgICAgIHRhcEFjdGlvbj17IGNvbnRlbnQgJiYgY29udGVudC50YXAgfVxuICAgICAgLz5cbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNvbm5lY3RUb1dlYkNoYXQoXG4gICh7IGxhbmd1YWdlIH0pID0+ICh7IGxhbmd1YWdlIH0pXG4pKFJlY2VpcHRDYXJkQXR0YWNobWVudClcbiJdfQ==