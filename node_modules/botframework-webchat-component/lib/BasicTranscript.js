"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _reactSay = require("react-say");

var _glamor = require("glamor");

var _classnames = _interopRequireDefault(require("classnames"));

var _react = _interopRequireDefault(require("react"));

var _reactScrollToBottom = require("react-scroll-to-bottom");

var _connectToWebChat = _interopRequireDefault(require("./connectToWebChat"));

var _ScrollToEndButton = _interopRequireDefault(require("./Activity/ScrollToEndButton"));

var _Speak = _interopRequireDefault(require("./Activity/Speak"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ROOT_CSS = (0, _glamor.css)({
  overflow: 'hidden',
  position: 'relative'
});
var PANEL_CSS = (0, _glamor.css)({
  display: 'flex',
  flexDirection: 'column',
  WebkitOverflowScrolling: 'touch'
});
var FILLER_CSS = (0, _glamor.css)({
  flex: 1
});
var LIST_CSS = (0, _glamor.css)({
  listStyleType: 'none',
  '& > li.hide-timestamp .transcript-timestamp': {
    display: 'none'
  }
});

function sameTimestampGroup(activityX, activityY, groupTimestamp) {
  if (groupTimestamp === false) {
    return true;
  } else if (activityX && activityY) {
    groupTimestamp = typeof groupTimestamp === 'number' ? groupTimestamp : 5 * 60 * 1000;

    if (activityX.from.role === activityY.from.role) {
      var timeX = new Date(activityX.timestamp).getTime();
      var timeY = new Date(activityY.timestamp).getTime();
      return Math.abs(timeX - timeY) <= groupTimestamp;
    }
  }

  return false;
}

var BasicTranscript = function BasicTranscript(_ref) {
  var activityRenderer = _ref.activityRenderer,
      activities = _ref.activities,
      attachmentRenderer = _ref.attachmentRenderer,
      className = _ref.className,
      groupTimestamp = _ref.groupTimestamp,
      styleSet = _ref.styleSet,
      webSpeechPonyfill = _ref.webSpeechPonyfill;

  var _ref2 = webSpeechPonyfill || {},
      speechSynthesis = _ref2.speechSynthesis,
      SpeechSynthesisUtterance = _ref2.SpeechSynthesisUtterance; // We use 2-pass approach for rendering activities, for show/hide timestamp grouping.
  // Until the activity pass thru middleware, we never know if it is going to show up.
  // After we know which activities will show up, we can compute which activity will show timestamps.
  // If the activity does not render, it will not be spoken if text-to-speech is enabled.


  var activityElements = activities.reduce(function (activityElements, activity) {
    var element = activityRenderer({
      activity: activity,
      timestampClassName: 'transcript-timestamp'
    })(function (_ref3) {
      var attachment = _ref3.attachment;
      return attachmentRenderer({
        activity: activity,
        attachment: attachment
      });
    });
    element && activityElements.push({
      activity: activity,
      element: element
    });
    return activityElements;
  }, []);
  return _react.default.createElement("div", {
    className: (0, _classnames.default)(ROOT_CSS + '', (className || '') + ''),
    role: "log"
  }, _react.default.createElement(_reactScrollToBottom.Panel, {
    className: PANEL_CSS + ''
  }, _react.default.createElement("div", {
    className: FILLER_CSS
  }), _react.default.createElement(_reactSay.Composer, {
    speechSynthesis: speechSynthesis,
    speechSynthesisUtterance: SpeechSynthesisUtterance
  }, _react.default.createElement("ul", {
    "aria-live": "polite",
    className: (0, _classnames.default)(LIST_CSS + '', styleSet.activities + ''),
    role: "list"
  }, activityElements.map(function (_ref4, index) {
    var activity = _ref4.activity,
        element = _ref4.element;
    return _react.default.createElement("li", {
      className: (0, _classnames.default)(styleSet.activity + '', {
        // Hide timestamp if same timestamp group with the next activity
        'hide-timestamp': sameTimestampGroup(activity, (activityElements[index + 1] || {}).activity, groupTimestamp)
      }),
      key: activity.channelData && activity.channelData.clientActivityID || activity.id || index,
      role: "listitem"
    }, element, // TODO: [P2] We should use core/definitions/speakingActivity for this predicate instead
    activity.channelData && activity.channelData.speak && _react.default.createElement(_Speak.default, {
      activity: activity
    }));
  })))), _react.default.createElement(_ScrollToEndButton.default, null));
};

var _default = (0, _connectToWebChat.default)(function (_ref5) {
  var activities = _ref5.activities,
      activityRenderer = _ref5.activityRenderer,
      attachmentRenderer = _ref5.attachmentRenderer,
      groupTimestamp = _ref5.groupTimestamp,
      styleSet = _ref5.styleSet,
      webSpeechPonyfill = _ref5.webSpeechPonyfill;
  return {
    activities: activities,
    activityRenderer: activityRenderer,
    attachmentRenderer: attachmentRenderer,
    groupTimestamp: groupTimestamp,
    styleSet: styleSet,
    webSpeechPonyfill: webSpeechPonyfill
  };
})(BasicTranscript);

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9CYXNpY1RyYW5zY3JpcHQuanMiXSwibmFtZXMiOlsiUk9PVF9DU1MiLCJvdmVyZmxvdyIsInBvc2l0aW9uIiwiUEFORUxfQ1NTIiwiZGlzcGxheSIsImZsZXhEaXJlY3Rpb24iLCJXZWJraXRPdmVyZmxvd1Njcm9sbGluZyIsIkZJTExFUl9DU1MiLCJmbGV4IiwiTElTVF9DU1MiLCJsaXN0U3R5bGVUeXBlIiwic2FtZVRpbWVzdGFtcEdyb3VwIiwiYWN0aXZpdHlYIiwiYWN0aXZpdHlZIiwiZ3JvdXBUaW1lc3RhbXAiLCJmcm9tIiwicm9sZSIsInRpbWVYIiwiRGF0ZSIsInRpbWVzdGFtcCIsImdldFRpbWUiLCJ0aW1lWSIsIk1hdGgiLCJhYnMiLCJCYXNpY1RyYW5zY3JpcHQiLCJhY3Rpdml0eVJlbmRlcmVyIiwiYWN0aXZpdGllcyIsImF0dGFjaG1lbnRSZW5kZXJlciIsImNsYXNzTmFtZSIsInN0eWxlU2V0Iiwid2ViU3BlZWNoUG9ueWZpbGwiLCJzcGVlY2hTeW50aGVzaXMiLCJTcGVlY2hTeW50aGVzaXNVdHRlcmFuY2UiLCJhY3Rpdml0eUVsZW1lbnRzIiwicmVkdWNlIiwiYWN0aXZpdHkiLCJlbGVtZW50IiwidGltZXN0YW1wQ2xhc3NOYW1lIiwiYXR0YWNobWVudCIsInB1c2giLCJtYXAiLCJpbmRleCIsImNoYW5uZWxEYXRhIiwiY2xpZW50QWN0aXZpdHlJRCIsImlkIiwic3BlYWsiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7OztBQUVBLElBQU1BLFFBQVEsR0FBRyxpQkFBSTtBQUNuQkMsRUFBQUEsUUFBUSxFQUFFLFFBRFM7QUFFbkJDLEVBQUFBLFFBQVEsRUFBRTtBQUZTLENBQUosQ0FBakI7QUFLQSxJQUFNQyxTQUFTLEdBQUcsaUJBQUk7QUFDcEJDLEVBQUFBLE9BQU8sRUFBRSxNQURXO0FBRXBCQyxFQUFBQSxhQUFhLEVBQUUsUUFGSztBQUdw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YjtBQUFBLE1BQ0VULFVBREYsU0FDRUEsVUFERjtBQUFBLE1BRUVELGdCQUZGLFNBRUVBLGdCQUZGO0FBQUEsTUFHRUUsa0JBSEYsU0FHRUEsa0JBSEY7QUFBQSxNQUlFYixjQUpGLFNBSUVBLGNBSkY7QUFBQSxNQUtFZSxRQUxGLFNBS0VBLFFBTEY7QUFBQSxNQU1FQyxpQkFORixTQU1FQSxpQkFORjtBQUFBLFNBT087QUFDTEosSUFBQUEsVUFBVSxFQUFWQSxVQURLO0FBRUxELElBQUFBLGdCQUFnQixFQUFoQkEsZ0JBRks7QUFHTEUsSUFBQUEsa0JBQWtCLEVBQWxCQSxrQkFISztBQUlMYixJQUFBQSxjQUFjLEVBQWRBLGNBSks7QUFLTGUsSUFBQUEsUUFBUSxFQUFSQSxRQUxLO0FBTUxDLElBQUFBLGlCQUFpQixFQUFqQkE7QUFOSyxHQVBQO0FBQUEsQ0FEYSxFQWdCYk4sZUFoQmEsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvc2VyIGFzIFNheUNvbXBvc2VyIH0gZnJvbSAncmVhY3Qtc2F5JztcbmltcG9ydCB7IGNzcyB9IGZyb20gJ2dsYW1vcic7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBQYW5lbCBhcyBTY3JvbGxUb0JvdHRvbVBhbmVsIH0gZnJvbSAncmVhY3Qtc2Nyb2xsLXRvLWJvdHRvbSc7XG5cbmltcG9ydCBjb25uZWN0VG9XZWJDaGF0IGZyb20gJy4vY29ubmVjdFRvV2ViQ2hhdCc7XG5pbXBvcnQgU2Nyb2xsVG9FbmRCdXR0b24gZnJvbSAnLi9BY3Rpdml0eS9TY3JvbGxUb0VuZEJ1dHRvbic7XG5pbXBvcnQgU3BlYWtBY3Rpdml0eSBmcm9tICcuL0FjdGl2aXR5L1NwZWFrJztcblxuY29uc3QgUk9PVF9DU1MgPSBjc3Moe1xuICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gIHBvc2l0aW9uOiAncmVsYXRpdmUnXG59KTtcblxuY29uc3QgUEFORUxfQ1NTID0gY3NzKHtcbiAgZGlzcGxheTogJ2ZsZXgnLFxuICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJyxcbiAgV2Via2l0T3ZlcmZsb3dTY3JvbGxpbmc6ICd0b3VjaCdcbn0pO1xuXG5jb25zdCBGSUxMRVJfQ1NTID0gY3NzKHtcbiAgZmxleDogMVxufSk7XG5cbmNvbnN0IExJU1RfQ1NTID0gY3NzKHtcbiAgbGlzdFN0eWxlVHlwZTogJ25vbmUnLFxuXG4gICcmID4gbGkuaGlkZS10aW1lc3RhbXAgLnRyYW5zY3JpcHQtdGltZXN0YW1wJzoge1xuICAgIGRpc3BsYXk6ICdub25lJ1xuICB9XG59KTtcblxuZnVuY3Rpb24gc2FtZVRpbWVzdGFtcEdyb3VwKGFjdGl2aXR5WCwgYWN0aXZpdHlZLCBncm91cFRpbWVzdGFtcCkge1xuICBpZiAoZ3JvdXBUaW1lc3RhbXAgPT09IGZhbHNlKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gZWxzZSBpZiAoYWN0aXZpdHlYICYmIGFjdGl2aXR5WSkge1xuICAgIGdyb3VwVGltZXN0YW1wID0gdHlwZW9mIGdyb3VwVGltZXN0YW1wID09PSAnbnVtYmVyJyA/IGdyb3VwVGltZXN0YW1wIDogNSAqIDYwICogMTAwMDtcblxuICAgIGlmIChhY3Rpdml0eVguZnJvbS5yb2xlID09PSBhY3Rpdml0eVkuZnJvbS5yb2xlKSB7XG4gICAgICBjb25zdCB0aW1lWCA9IG5ldyBEYXRlKGFjdGl2aXR5WC50aW1lc3RhbXApLmdldFRpbWUoKTtcbiAgICAgIGNvbnN0IHRpbWVZID0gbmV3IERhdGUoYWN0aXZpdHlZLnRpbWVzdGFtcCkuZ2V0VGltZSgpO1xuXG4gICAgICByZXR1cm4gTWF0aC5hYnModGltZVggLSB0aW1lWSkgPD0gZ3JvdXBUaW1lc3RhbXA7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5jb25zdCBCYXNpY1RyYW5zY3JpcHQgPSAoe1xuICBhY3Rpdml0eVJlbmRlcmVyLFxuICBhY3Rpdml0aWVzLFxuICBhdHRhY2htZW50UmVuZGVyZXIsXG4gIGNsYXNzTmFtZSxcbiAgZ3JvdXBUaW1lc3RhbXAsXG4gIHN0eWxlU2V0LFxuICB3ZWJTcGVlY2hQb255ZmlsbFxufSkgPT4ge1xuICBjb25zdCB7IHNwZWVjaFN5bnRoZXNpcywgU3BlZWNoU3ludGhlc2lzVXR0ZXJhbmNlIH0gPSB3ZWJTcGVlY2hQb255ZmlsbCB8fCB7fTtcblxuICAvLyBXZSB1c2UgMi1wYXNzIGFwcHJvYWNoIGZvciByZW5kZXJpbmcgYWN0aXZpdGllcywgZm9yIHNob3cvaGlkZSB0aW1lc3RhbXAgZ3JvdXBpbmcuXG4gIC8vIFVudGlsIHRoZSBhY3Rpdml0eSBwYXNzIHRocnUgbWlkZGxld2FyZSwgd2UgbmV2ZXIga25vdyBpZiBpdCBpcyBnb2luZyB0byBzaG93IHVwLlxuICAvLyBBZnRlciB3ZSBrbm93IHdoaWNoIGFjdGl2aXRpZXMgd2lsbCBzaG93IHVwLCB3ZSBjYW4gY29tcHV0ZSB3aGljaCBhY3Rpdml0eSB3aWxsIHNob3cgdGltZXN0YW1wcy5cbiAgLy8gSWYgdGhlIGFjdGl2aXR5IGRvZXMgbm90IHJlbmRlciwgaXQgd2lsbCBub3QgYmUgc3Bva2VuIGlmIHRleHQtdG8tc3BlZWNoIGlzIGVuYWJsZWQuXG4gIGNvbnN0IGFjdGl2aXR5RWxlbWVudHMgPSBhY3Rpdml0aWVzLnJlZHVjZSgoYWN0aXZpdHlFbGVtZW50cywgYWN0aXZpdHkpID0+IHtcbiAgICBjb25zdCBlbGVtZW50ID0gYWN0aXZpdHlSZW5kZXJlcih7XG4gICAgICBhY3Rpdml0eSxcbiAgICAgIHRpbWVzdGFtcENsYXNzTmFtZTogJ3RyYW5zY3JpcHQtdGltZXN0YW1wJ1xuICAgIH0pKFxuICAgICAgKHsgYXR0YWNobWVudCB9KSA9PiBhdHRhY2htZW50UmVuZGVyZXIoeyBhY3Rpdml0eSwgYXR0YWNobWVudCB9KVxuICAgICk7XG5cbiAgICBlbGVtZW50ICYmIGFjdGl2aXR5RWxlbWVudHMucHVzaCh7XG4gICAgICBhY3Rpdml0eSxcbiAgICAgIGVsZW1lbnRcbiAgICB9KTtcblxuICAgIHJldHVybiBhY3Rpdml0eUVsZW1lbnRzO1xuICB9LCBbXSk7XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2XG4gICAgICBjbGFzc05hbWU9eyBjbGFzc05hbWVzKFxuICAgICAgICBST09UX0NTUyArICcnLFxuICAgICAgICAoY2xhc3NOYW1lIHx8ICcnKSArICcnXG4gICAgICApIH1cbiAgICAgIHJvbGU9XCJsb2dcIlxuICAgID5cbiAgICAgIDxTY3JvbGxUb0JvdHRvbVBhbmVsIGNsYXNzTmFtZT17IFBBTkVMX0NTUyArICcnIH0+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPXsgRklMTEVSX0NTUyB9IC8+XG4gICAgICAgIDxTYXlDb21wb3NlclxuICAgICAgICAgIHNwZWVjaFN5bnRoZXNpcz17IHNwZWVjaFN5bnRoZXNpcyB9XG4gICAgICAgICAgc3BlZWNoU3ludGhlc2lzVXR0ZXJhbmNlPXsgU3BlZWNoU3ludGhlc2lzVXR0ZXJhbmNlIH1cbiAgICAgICAgPlxuICAgICAgICAgIDx1bFxuICAgICAgICAgICAgYXJpYS1saXZlPVwicG9saXRlXCJcbiAgICAgICAgICAgIGNsYXNzTmFtZT17IGNsYXNzTmFtZXMoTElTVF9DU1MgKyAnJywgc3R5bGVTZXQuYWN0aXZpdGllcyArICcnKSB9XG4gICAgICAgICAgICByb2xlPVwibGlzdFwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLm1hcCgoeyBhY3Rpdml0eSwgZWxlbWVudCB9LCBpbmRleCkgPT5cbiAgICAgICAgICAgICAgICA8bGlcbiAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17IGNsYXNzTmFtZXMoXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlU2V0LmFjdGl2aXR5ICsgJycsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAvLyBIaWRlIHRpbWVzdGFtcCBpZiBzYW1lIHRpbWVzdGFtcCBncm91cCB3aXRoIHRoZSBuZXh0IGFjdGl2aXR5XG4gICAgICAgICAgICAgICAgICAgICAgJ2hpZGUtdGltZXN0YW1wJzogc2FtZVRpbWVzdGFtcEdyb3VwKGFjdGl2aXR5LCAoYWN0aXZpdHlFbGVtZW50c1tpbmRleCArIDFdIHx8IHt9KS5hY3Rpdml0eSwgZ3JvdXBUaW1lc3RhbXApXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICkgfVxuICAgICAgICAgICAgICAgICAga2V5PXsgKGFjdGl2aXR5LmNoYW5uZWxEYXRhICYmIGFjdGl2aXR5LmNoYW5uZWxEYXRhLmNsaWVudEFjdGl2aXR5SUQpIHx8IGFjdGl2aXR5LmlkIHx8IGluZGV4IH1cbiAgICAgICAgICAgICAgICAgIHJvbGU9XCJsaXN0aXRlbVwiXG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgeyBlbGVtZW50IH1cbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogW1AyXSBXZSBzaG91bGQgdXNlIGNvcmUvZGVmaW5pdGlvbnMvc3BlYWtpbmdBY3Rpdml0eSBmb3IgdGhpcyBwcmVkaWNhdGUgaW5zdGVhZFxuICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS5jaGFubmVsRGF0YSAmJiBhY3Rpdml0eS5jaGFubmVsRGF0YS5zcGVhayAmJiA8U3BlYWtBY3Rpdml0eSBhY3Rpdml0eT17IGFjdGl2aXR5IH0gLz5cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA8L2xpPlxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9XG4gICAgICAgICAgPC91bD5cbiAgICAgICAgPC9TYXlDb21wb3Nlcj5cbiAgICAgIDwvU2Nyb2xsVG9Cb3R0b21QYW5lbD5cbiAgICAgIDxTY3JvbGxUb0VuZEJ1dHRvbiAvPlxuICAgIDwvZGl2PlxuICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjb25uZWN0VG9XZWJDaGF0KFxuICAoe1xuICAgIGFjdGl2aXRpZXMsXG4gICAgYWN0aXZpdHlSZW5kZXJlcixcbiAgICBhdHRhY2htZW50UmVuZGVyZXIsXG4gICAgZ3JvdXBUaW1lc3RhbXAsXG4gICAgc3R5bGVTZXQsXG4gICAgd2ViU3BlZWNoUG9ueWZpbGxcbiAgfSkgPT4gKHtcbiAgICBhY3Rpdml0aWVzLFxuICAgIGFjdGl2aXR5UmVuZGVyZXIsXG4gICAgYXR0YWNobWVudFJlbmRlcmVyLFxuICAgIGdyb3VwVGltZXN0YW1wLFxuICAgIHN0eWxlU2V0LFxuICAgIHdlYlNwZWVjaFBvbnlmaWxsXG4gIH0pXG4pKEJhc2ljVHJhbnNjcmlwdClcbiJdfQ==