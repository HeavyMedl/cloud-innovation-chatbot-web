"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireDefault(require("react"));

var _Localize = require("../Localization/Localize");

var _connectToWebChat = _interopRequireDefault(require("../connectToWebChat"));

var _Timer = _interopRequireDefault(require("./Timer"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function nextTimer(date) {
  var time = new Date(date).getTime();
  var now = Date.now();

  if (time > now) {
    return time;
  } else {
    return Math.ceil((now - time) / 60000) * 60000 + time;
  }
}

var TimeAgo =
/*#__PURE__*/
function (_React$Component) {
  _inherits(TimeAgo, _React$Component);

  function TimeAgo(props) {
    var _this;

    _classCallCheck(this, TimeAgo);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(TimeAgo).call(this, props));
    _this.handleInterval = _this.handleInterval.bind(_assertThisInitialized(_this));
    _this.state = _this.getStateFromProps(props);
    return _this;
  }

  _createClass(TimeAgo, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      this.updateText(nextProps);
    }
  }, {
    key: "handleInterval",
    value: function handleInterval() {
      this.updateText(this.props);
    }
  }, {
    key: "updateText",
    value: function updateText(props) {
      var _this2 = this;

      this.setState(function () {
        return _this2.getStateFromProps(props);
      });
    }
  }, {
    key: "getStateFromProps",
    value: function getStateFromProps(props) {
      return {
        text: (0, _Localize.localize)('X minutes ago', props.language, props.value),
        timer: nextTimer(props.value)
      };
    }
  }, {
    key: "render",
    value: function render() {
      var state = this.state;
      return _react.default.createElement(_react.default.Fragment, null, state.text, _react.default.createElement(_Timer.default, {
        at: state.timer,
        onInterval: this.handleInterval
      }));
    }
  }]);

  return TimeAgo;
}(_react.default.Component);

var _default = (0, _connectToWebChat.default)(function (_ref) {
  var language = _ref.language;
  return {
    language: language
  };
})(TimeAgo);

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9VdGlscy9UaW1lQWdvLmpzIl0sIm5hbWVzIjpbIm5leHRUaW1lciIsImRhdGUiLCJ0aW1lIiwiRGF0ZSIsImdldFRpbWUiLCJub3ciLCJNYXRoIiwiY2VpbCIsIlRpbWVBZ28iLCJwcm9wcyIsImhhbmRsZUludGVydmFsIiwiYmluZCIsInN0YXRlIiwiZ2V0U3RhdGVGcm9tUHJvcHMiLCJuZXh0UHJvcHMiLCJ1cGRhdGVUZXh0Iiwic2V0U3RhdGUiLCJ0ZXh0IiwibGFuZ3VhZ2UiLCJ2YWx1ZSIsInRpbWVyIiwiUmVhY3QiLCJDb21wb25lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFFQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLFNBQVNBLFNBQVQsQ0FBbUJDLElBQW5CLEVBQXlCO0FBQ3ZCLE1BQU1DLElBQUksR0FBRyxJQUFJQyxJQUFKLENBQVNGLElBQVQsRUFBZUcsT0FBZixFQUFiO0FBQ0EsTUFBTUMsR0FBRyxHQUFHRixJQUFJLENBQUNFLEdBQUwsRUFBWjs7QUFFQSxNQUFJSCxJQUFJLEdBQUdHLEdBQVgsRUFBZ0I7QUFDZCxXQUFPSCxJQUFQO0FBQ0QsR0FGRCxNQUVPO0FBQ0wsV0FBT0ksSUFBSSxDQUFDQyxJQUFMLENBQVUsQ0FBQ0YsR0FBRyxHQUFHSCxJQUFQLElBQWUsS0FBekIsSUFBa0MsS0FBbEMsR0FBMENBLElBQWpEO0FBQ0Q7QUFDRjs7SUFFS00sTzs7Ozs7QUFDSixtQkFBWUMsS0FBWixFQUFtQjtBQUFBOztBQUFBOztBQUNqQixpRkFBTUEsS0FBTjtBQUVBLFVBQUtDLGNBQUwsR0FBc0IsTUFBS0EsY0FBTCxDQUFvQkMsSUFBcEIsK0JBQXRCO0FBRUEsVUFBS0MsS0FBTCxHQUFhLE1BQUtDLGlCQUFMLENBQXVCSixLQUF2QixDQUFiO0FBTGlCO0FBTWxCOzs7OzhDQUV5QkssUyxFQUFXO0FBQ25DLFdBQUtDLFVBQUwsQ0FBZ0JELFNBQWhCO0FBQ0Q7OztxQ0FFZ0I7QUFDZixXQUFLQyxVQUFMLENBQWdCLEtBQUtOLEtBQXJCO0FBQ0Q7OzsrQkFFVUEsSyxFQUFPO0FBQUE7O0FBQ2hCLFdBQUtPLFFBQUwsQ0FBYztBQUFBLGVBQU0sTUFBSSxDQUFDSCxpQkFBTCxDQUF1QkosS0FBdkIsQ0FBTjtBQUFBLE9BQWQ7QUFDRDs7O3NDQUVpQkEsSyxFQUFPO0FBQ3ZCLGFBQU87QUFDTFEsUUFBQUEsSUFBSSxFQUFFLHdCQUFTLGVBQVQsRUFBMEJSLEtBQUssQ0FBQ1MsUUFBaEMsRUFBMENULEtBQUssQ0FBQ1UsS0FBaEQsQ0FERDtBQUVMQyxRQUFBQSxLQUFLLEVBQUVwQixTQUFTLENBQUNTLEtBQUssQ0FBQ1UsS0FBUDtBQUZYLE9BQVA7QUFJRDs7OzZCQUVRO0FBQUEsVUFDQ1AsS0FERCxHQUNXLElBRFgsQ0FDQ0EsS0FERDtBQUdQLGFBQ0UsNkJBQUMsY0FBRCxDQUFPLFFBQVAsUUFDSUEsS0FBSyxDQUFDSyxJQURWLEVBRUUsNkJBQUMsY0FBRDtBQUFPLFFBQUEsRUFBRSxFQUFHTCxLQUFLLENBQUNRLEtBQWxCO0FBQTBCLFFBQUEsVUFBVSxFQUFHLEtBQUtWO0FBQTVDLFFBRkYsQ0FERjtBQU1EOzs7O0VBckNtQlcsZUFBTUMsUzs7ZUF3Q2IsK0JBQ2I7QUFBQSxNQUFHSixRQUFILFFBQUdBLFFBQUg7QUFBQSxTQUFtQjtBQUFFQSxJQUFBQSxRQUFRLEVBQVJBO0FBQUYsR0FBbkI7QUFBQSxDQURhLEVBRWJWLE9BRmEsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCB7IGxvY2FsaXplIH0gZnJvbSAnLi4vTG9jYWxpemF0aW9uL0xvY2FsaXplJztcbmltcG9ydCBjb25uZWN0VG9XZWJDaGF0IGZyb20gJy4uL2Nvbm5lY3RUb1dlYkNoYXQnO1xuaW1wb3J0IFRpbWVyIGZyb20gJy4vVGltZXInO1xuXG5mdW5jdGlvbiBuZXh0VGltZXIoZGF0ZSkge1xuICBjb25zdCB0aW1lID0gbmV3IERhdGUoZGF0ZSkuZ2V0VGltZSgpO1xuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuXG4gIGlmICh0aW1lID4gbm93KSB7XG4gICAgcmV0dXJuIHRpbWU7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIE1hdGguY2VpbCgobm93IC0gdGltZSkgLyA2MDAwMCkgKiA2MDAwMCArIHRpbWU7XG4gIH1cbn1cblxuY2xhc3MgVGltZUFnbyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgdGhpcy5oYW5kbGVJbnRlcnZhbCA9IHRoaXMuaGFuZGxlSW50ZXJ2YWwuYmluZCh0aGlzKTtcblxuICAgIHRoaXMuc3RhdGUgPSB0aGlzLmdldFN0YXRlRnJvbVByb3BzKHByb3BzKTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgdGhpcy51cGRhdGVUZXh0KG5leHRQcm9wcyk7XG4gIH1cblxuICBoYW5kbGVJbnRlcnZhbCgpIHtcbiAgICB0aGlzLnVwZGF0ZVRleHQodGhpcy5wcm9wcyk7XG4gIH1cblxuICB1cGRhdGVUZXh0KHByb3BzKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSgoKSA9PiB0aGlzLmdldFN0YXRlRnJvbVByb3BzKHByb3BzKSk7XG4gIH1cblxuICBnZXRTdGF0ZUZyb21Qcm9wcyhwcm9wcykge1xuICAgIHJldHVybiB7XG4gICAgICB0ZXh0OiBsb2NhbGl6ZSgnWCBtaW51dGVzIGFnbycsIHByb3BzLmxhbmd1YWdlLCBwcm9wcy52YWx1ZSksXG4gICAgICB0aW1lcjogbmV4dFRpbWVyKHByb3BzLnZhbHVlKVxuICAgIH07XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcblxuICAgIHJldHVybiAoXG4gICAgICA8UmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgIHsgc3RhdGUudGV4dCB9XG4gICAgICAgIDxUaW1lciBhdD17IHN0YXRlLnRpbWVyIH0gb25JbnRlcnZhbD17IHRoaXMuaGFuZGxlSW50ZXJ2YWwgfSAvPlxuICAgICAgPC9SZWFjdC5GcmFnbWVudD5cbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNvbm5lY3RUb1dlYkNoYXQoXG4gICh7IGxhbmd1YWdlIH0pID0+ICh7IGxhbmd1YWdlIH0pXG4pKFRpbWVBZ28pXG4iXX0=