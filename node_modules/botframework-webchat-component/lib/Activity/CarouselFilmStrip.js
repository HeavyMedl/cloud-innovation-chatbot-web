"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.connectCarouselFilmStrip = exports.default = void 0;

var _glamor = require("glamor");

var _reactFilm = require("react-film");

var _classnames = _interopRequireDefault(require("classnames"));

var _react = _interopRequireDefault(require("react"));

var _botframeworkWebchatCore = require("botframework-webchat-core");

var _Localize = require("../Localization/Localize");

var _Avatar = _interopRequireDefault(require("./Avatar"));

var _Bubble = _interopRequireDefault(require("./Bubble"));

var _connectToWebChat = _interopRequireDefault(require("../connectToWebChat"));

var _SendStatus = _interopRequireDefault(require("./SendStatus"));

var _textFormatToContentType = _interopRequireDefault(require("../Utils/textFormatToContentType"));

var _Timestamp = _interopRequireDefault(require("./Timestamp"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

var _Constants$ActivityCl = _botframeworkWebchatCore.Constants.ActivityClientState,
    SENDING = _Constants$ActivityCl.SENDING,
    SEND_FAILED = _Constants$ActivityCl.SEND_FAILED;
var ROOT_CSS = (0, _glamor.css)({
  display: 'flex',
  MsOverflowStyle: 'none',
  overflowX: 'scroll',
  overflowY: 'hidden',
  touchAction: 'manipulation',
  WebkitOverflowScrolling: 'touch',
  '&::-webkit-scrollbar': {
    display: 'none'
  },
  '& > .avatar': {
    flexShrink: 0
  },
  '& > .content': {
    flex: 1,
    '& > .message': {
      display: 'flex',
      '& > .bubble': {
        flexGrow: 1,
        overflow: 'hidden'
      },
      '& > .filler': {
        flexGrow: 10000,
        flexShrink: 1
      }
    },
    '& > ul': {
      display: 'flex',
      listStyleType: 'none',
      margin: 0,
      padding: 0,
      '& > li': {
        flex: 1
      }
    }
  }
});

var connectCarouselFilmStrip = function connectCarouselFilmStrip() {
  for (var _len = arguments.length, selectors = new Array(_len), _key = 0; _key < _len; _key++) {
    selectors[_key] = arguments[_key];
  }

  return _connectToWebChat.default.apply(void 0, [function (_ref, _ref2) {
    var language = _ref.language,
        _ref$styleSet$options = _ref.styleSet.options,
        botAvatarInitials = _ref$styleSet$options.botAvatarInitials,
        userAvatarInitials = _ref$styleSet$options.userAvatarInitials;
    var activity = _ref2.activity;
    return {
      avatarInitials: activity.from && activity.from.role === 'user' ? userAvatarInitials : botAvatarInitials,
      language: language
    };
  }].concat(selectors));
};

exports.connectCarouselFilmStrip = connectCarouselFilmStrip;
var ConnectedCarouselFilmStrip = connectCarouselFilmStrip(function (_ref3) {
  var avatarInitials = _ref3.avatarInitials,
      language = _ref3.language,
      styleSet = _ref3.styleSet;
  return {
    avatarInitials: avatarInitials,
    language: language,
    styleSet: styleSet
  };
})(function (_ref4) {
  var activity = _ref4.activity,
      avatarInitials = _ref4.avatarInitials,
      children = _ref4.children,
      language = _ref4.language,
      className = _ref4.className,
      itemContainerRef = _ref4.itemContainerRef,
      scrollableRef = _ref4.scrollableRef,
      styleSet = _ref4.styleSet,
      timestampClassName = _ref4.timestampClassName;
  var fromUser = activity.from.role === 'user';
  var ariaLabel = (0, _Localize.localize)('Bot said something', language, avatarInitials, activity.text, activity.timestamp);
  var activityDisplayText = activity.channelData && activity.channelData.messageBack && activity.channelData.messageBack.displayText || activity.text;
  return _react.default.createElement("div", {
    className: (0, _classnames.default)(ROOT_CSS + '', styleSet.carouselFilmStrip + '', (className || '') + ''),
    ref: scrollableRef
  }, _react.default.createElement(_Avatar.default, {
    "aria-hidden": true,
    className: "avatar",
    fromUser: fromUser
  }), _react.default.createElement("div", {
    className: "content"
  }, !!activityDisplayText && _react.default.createElement("div", {
    className: "message"
  }, _react.default.createElement(_Bubble.default, {
    "aria-label": ariaLabel,
    className: "bubble",
    fromUser: fromUser
  }, children({
    activity: activity,
    attachment: {
      contentType: (0, _textFormatToContentType.default)(activity.textFormat),
      content: activityDisplayText
    }
  })), _react.default.createElement("div", {
    className: "filler"
  })), _react.default.createElement("ul", {
    ref: itemContainerRef
  }, activity.attachments.map(function (attachment, index) {
    return _react.default.createElement("li", {
      key: index
    }, _react.default.createElement(_Bubble.default, {
      fromUser: fromUser,
      key: index
    }, children({
      attachment: attachment
    })));
  })), _react.default.createElement("div", {
    "aria-hidden": true,
    className: "webchat__row"
  }, activity.channelData && (activity.channelData.state === SENDING || activity.channelData.state === SEND_FAILED) ? _react.default.createElement(_SendStatus.default, {
    activity: activity
  }) : _react.default.createElement(_Timestamp.default, {
    activity: activity,
    className: timestampClassName
  }))));
});

var _default = function _default(props) {
  return _react.default.createElement(_reactFilm.Context.Consumer, null, function (_ref5) {
    var itemContainerRef = _ref5.itemContainerRef,
        scrollableRef = _ref5.scrollableRef;
    return _react.default.createElement(ConnectedCarouselFilmStrip, _extends({
      itemContainerRef: itemContainerRef,
      scrollableRef: scrollableRef
    }, props));
  });
};

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9BY3Rpdml0eS9DYXJvdXNlbEZpbG1TdHJpcC5qcyJdLCJuYW1lcyI6WyJDb25zdGFudHMiLCJBY3Rpdml0eUNsaWVudFN0YXRlIiwiU0VORElORyIsIlNFTkRfRkFJTEVEIiwiUk9PVF9DU1MiLCJkaXNwbGF5IiwiTXNPdmVyZmxvd1N0eWxlIiwib3ZlcmZsb3dYIiwib3ZlcmZsb3dZIiwidG91Y2hBY3Rpb24iLCJXZWJraXRPdmVyZmxvd1Njcm9sbGluZyIsImZsZXhTaHJpbmsiLCJmbGV4IiwiZmxleEdyb3ciLCJvdmVyZmxvdyIsImxpc3RTdHlsZVR5cGUiLCJtYXJnaW4iLCJwYWRkaW5nIiwiY29ubmVjdENhcm91c2VsRmlsbVN0cmlwIiwic2VsZWN0b3JzIiwiY29ubmVjdFRvV2ViQ2hhdCIsImxhbmd1YWdlIiwic3R5bGVTZXQiLCJvcHRpb25zIiwiYm90QXZhdGFySW5pdGlhbHMiLCJ1c2VyQXZhdGFySW5pdGlhbHMiLCJhY3Rpdml0eSIsImF2YXRhckluaXRpYWxzIiwiZnJvbSIsInJvbGUiLCJDb25uZWN0ZWRDYXJvdXNlbEZpbG1TdHJpcCIsImNoaWxkcmVuIiwiY2xhc3NOYW1lIiwiaXRlbUNvbnRhaW5lclJlZiIsInNjcm9sbGFibGVSZWYiLCJ0aW1lc3RhbXBDbGFzc05hbWUiLCJmcm9tVXNlciIsImFyaWFMYWJlbCIsInRleHQiLCJ0aW1lc3RhbXAiLCJhY3Rpdml0eURpc3BsYXlUZXh0IiwiY2hhbm5lbERhdGEiLCJtZXNzYWdlQmFjayIsImRpc3BsYXlUZXh0IiwiY2Fyb3VzZWxGaWxtU3RyaXAiLCJhdHRhY2htZW50IiwiY29udGVudFR5cGUiLCJ0ZXh0Rm9ybWF0IiwiY29udGVudCIsImF0dGFjaG1lbnRzIiwibWFwIiwiaW5kZXgiLCJzdGF0ZSIsInByb3BzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7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QUFULENBQXFCQyxHQUFyQixDQUF5QixVQUFDTCxVQUFELEVBQWFNLEtBQWI7QUFBQSxXQUN2QjtBQUFJLE1BQUEsR0FBRyxFQUFHQTtBQUFWLE9BQ0UsNkJBQUMsZUFBRDtBQUNFLE1BQUEsUUFBUSxFQUFHZixRQURiO0FBRUUsTUFBQSxHQUFHLEVBQUdlO0FBRlIsT0FJSXBCLFFBQVEsQ0FBQztBQUFFYyxNQUFBQSxVQUFVLEVBQVZBO0FBQUYsS0FBRCxDQUpaLENBREYsQ0FEdUI7QUFBQSxHQUF6QixDQUZKLENBcEJGLEVBa0NFO0FBQ0UsbUJBQWMsSUFEaEI7QUFFRSxJQUFBLFNBQVMsRUFBQztBQUZaLEtBS0luQixRQUFRLENBQUNlLFdBQVQsS0FFRWYsUUFBUSxDQUFDZSxXQUFULENBQXFCVyxLQUFyQixLQUErQmxELE9BQS9CLElBQ0d3QixRQUFRLENBQUNlLFdBQVQsQ0FBcUJXLEtBQXJCLEtBQStCakQsV0FIcEMsQ0FERCxHQU9DLDZCQUFDLG1CQUFEO0FBQVksSUFBQSxRQUFRLEVBQUd1QjtBQUF2QixJQVBELEdBU0MsNkJBQUMsa0JBQUQ7QUFDRSxJQUFBLFFBQVEsRUFBR0EsUUFEYjtBQUVFLElBQUEsU0FBUyxFQUFHUztBQUZkLElBYkosQ0FsQ0YsQ0FiRixDQURGO0FBc0VELENBckdnQyxDQUFuQzs7ZUF3R2Usa0JBQUFrQixLQUFLO0FBQUEsU0FDbEIsNkJBQUMsa0JBQUQsQ0FBYSxRQUFiLFFBQ0k7QUFBQSxRQUFHcEIsZ0JBQUgsU0FBR0EsZ0JBQUg7QUFBQSxRQUFxQkMsYUFBckIsU0FBcUJBLGFBQXJCO0FBQUEsV0FDQSw2QkFBQywwQkFBRDtBQUNFLE1BQUEsZ0JBQWdCLEVBQUdELGdCQURyQjtBQUVFLE1BQUEsYUFBYSxFQUFHQztBQUZsQixPQUdPbUIsS0FIUCxFQURBO0FBQUEsR0FESixDQURrQjtBQUFBLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjc3MgfSBmcm9tICdnbGFtb3InO1xuaW1wb3J0IHsgQ29udGV4dCBhcyBGaWxtQ29udGV4dCB9IGZyb20gJ3JlYWN0LWZpbG0nO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgeyBDb25zdGFudHMgfSBmcm9tICdib3RmcmFtZXdvcmstd2ViY2hhdC1jb3JlJztcblxuaW1wb3J0IHsgbG9jYWxpemUgfSBmcm9tICcuLi9Mb2NhbGl6YXRpb24vTG9jYWxpemUnO1xuaW1wb3J0IEF2YXRhciBmcm9tICcuL0F2YXRhcic7XG5pbXBvcnQgQnViYmxlIGZyb20gJy4vQnViYmxlJztcbmltcG9ydCBjb25uZWN0VG9XZWJDaGF0IGZyb20gJy4uL2Nvbm5lY3RUb1dlYkNoYXQnO1xuaW1wb3J0IFNlbmRTdGF0dXMgZnJvbSAnLi9TZW5kU3RhdHVzJztcbmltcG9ydCB0ZXh0Rm9ybWF0VG9Db250ZW50VHlwZSBmcm9tICcuLi9VdGlscy90ZXh0Rm9ybWF0VG9Db250ZW50VHlwZSc7XG5pbXBvcnQgVGltZXN0YW1wIGZyb20gJy4vVGltZXN0YW1wJztcblxuY29uc3QgeyBBY3Rpdml0eUNsaWVudFN0YXRlOiB7IFNFTkRJTkcsIFNFTkRfRkFJTEVEIH0gfSA9IENvbnN0YW50cztcblxuY29uc3QgUk9PVF9DU1MgPSBjc3Moe1xuICBkaXNwbGF5OiAnZmxleCcsXG4gIE1zT3ZlcmZsb3dTdHlsZTogJ25vbmUnLFxuICBvdmVyZmxvd1g6ICdzY3JvbGwnLFxuICBvdmVyZmxvd1k6ICdoaWRkZW4nLFxuICB0b3VjaEFjdGlvbjogJ21hbmlwdWxhdGlvbicsXG4gIFdlYmtpdE92ZXJmbG93U2Nyb2xsaW5nOiAndG91Y2gnLFxuXG4gICcmOjotd2Via2l0LXNjcm9sbGJhcic6IHtcbiAgICBkaXNwbGF5OiAnbm9uZSdcbiAgfSxcblxuICAnJiA+IC5hdmF0YXInOiB7XG4gICAgZmxleFNocmluazogMFxuICB9LFxuXG4gICcmID4gLmNvbnRlbnQnOiB7XG4gICAgZmxleDogMSxcblxuICAgICcmID4gLm1lc3NhZ2UnOiB7XG4gICAgICBkaXNwbGF5OiAnZmxleCcsXG5cbiAgICAgICcmID4gLmJ1YmJsZSc6IHtcbiAgICAgICAgZmxleEdyb3c6IDEsXG4gICAgICAgIG92ZXJmbG93OiAnaGlkZGVuJ1xuICAgICAgfSxcblxuICAgICAgJyYgPiAuZmlsbGVyJzoge1xuICAgICAgICBmbGV4R3JvdzogMTAwMDAsXG4gICAgICAgIGZsZXhTaHJpbms6IDFcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgJyYgPiB1bCc6IHtcbiAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgIGxpc3RTdHlsZVR5cGU6ICdub25lJyxcbiAgICAgIG1hcmdpbjogMCxcbiAgICAgIHBhZGRpbmc6IDAsXG5cbiAgICAgICcmID4gbGknOiB7XG4gICAgICAgIGZsZXg6IDFcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pO1xuXG5jb25zdCBjb25uZWN0Q2Fyb3VzZWxGaWxtU3RyaXAgPSAoLi4uc2VsZWN0b3JzKSA9PiBjb25uZWN0VG9XZWJDaGF0KFxuICAoe1xuICAgIGxhbmd1YWdlLFxuICAgIHN0eWxlU2V0OiB7XG4gICAgICBvcHRpb25zOiB7XG4gICAgICAgIGJvdEF2YXRhckluaXRpYWxzLFxuICAgICAgICB1c2VyQXZhdGFySW5pdGlhbHNcbiAgICAgIH1cbiAgICB9XG4gIH0sIHsgYWN0aXZpdHkgfSkgPT4gKHtcbiAgICBhdmF0YXJJbml0aWFsczogYWN0aXZpdHkuZnJvbSAmJiBhY3Rpdml0eS5mcm9tLnJvbGUgPT09ICd1c2VyJyA/IHVzZXJBdmF0YXJJbml0aWFscyA6IGJvdEF2YXRhckluaXRpYWxzLFxuICAgIGxhbmd1YWdlXG4gIH0pLFxuICAuLi5zZWxlY3RvcnNcbilcblxuY29uc3QgQ29ubmVjdGVkQ2Fyb3VzZWxGaWxtU3RyaXAgPSBjb25uZWN0Q2Fyb3VzZWxGaWxtU3RyaXAoXG4gICh7XG4gICAgYXZhdGFySW5pdGlhbHMsXG4gICAgbGFuZ3VhZ2UsXG4gICAgc3R5bGVTZXRcbiAgfSkgPT4gKHtcbiAgICBhdmF0YXJJbml0aWFscyxcbiAgICBsYW5ndWFnZSxcbiAgICBzdHlsZVNldFxuICB9KVxuKShcbiAgKHtcbiAgICBhY3Rpdml0eSxcbiAgICBhdmF0YXJJbml0aWFscyxcbiAgICBjaGlsZHJlbixcbiAgICBsYW5ndWFnZSxcbiAgICBjbGFzc05hbWUsXG4gICAgaXRlbUNvbnRhaW5lclJlZixcbiAgICBzY3JvbGxhYmxlUmVmLFxuICAgIHN0eWxlU2V0LFxuICAgIHRpbWVzdGFtcENsYXNzTmFtZVxuICB9KSA9PiB7XG4gICAgY29uc3QgZnJvbVVzZXIgPSBhY3Rpdml0eS5mcm9tLnJvbGUgPT09ICd1c2VyJztcbiAgICBjb25zdCBhcmlhTGFiZWwgPSBsb2NhbGl6ZSgnQm90IHNhaWQgc29tZXRoaW5nJywgbGFuZ3VhZ2UsIGF2YXRhckluaXRpYWxzLCBhY3Rpdml0eS50ZXh0LCBhY3Rpdml0eS50aW1lc3RhbXApXG4gICAgY29uc3QgYWN0aXZpdHlEaXNwbGF5VGV4dCA9XG4gICAgICAoXG4gICAgICAgIGFjdGl2aXR5LmNoYW5uZWxEYXRhXG4gICAgICAgICYmIGFjdGl2aXR5LmNoYW5uZWxEYXRhLm1lc3NhZ2VCYWNrXG4gICAgICAgICYmIGFjdGl2aXR5LmNoYW5uZWxEYXRhLm1lc3NhZ2VCYWNrLmRpc3BsYXlUZXh0XG4gICAgICApIHx8IGFjdGl2aXR5LnRleHQ7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICBjbGFzc05hbWU9eyBjbGFzc05hbWVzKFxuICAgICAgICAgIFJPT1RfQ1NTICsgJycsXG4gICAgICAgICAgc3R5bGVTZXQuY2Fyb3VzZWxGaWxtU3RyaXAgKyAnJyxcbiAgICAgICAgICAoY2xhc3NOYW1lIHx8ICcnKSArICcnXG4gICAgICAgICkgfVxuICAgICAgICByZWY9eyBzY3JvbGxhYmxlUmVmIH1cbiAgICAgID5cbiAgICAgICAgPEF2YXRhclxuICAgICAgICAgIGFyaWEtaGlkZGVuPXsgdHJ1ZSB9XG4gICAgICAgICAgY2xhc3NOYW1lPVwiYXZhdGFyXCJcbiAgICAgICAgICBmcm9tVXNlcj17IGZyb21Vc2VyIH1cbiAgICAgICAgLz5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJjb250ZW50XCI+XG4gICAgICAgICAge1xuICAgICAgICAgICAgISFhY3Rpdml0eURpc3BsYXlUZXh0ICYmXG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibWVzc2FnZVwiPlxuICAgICAgICAgICAgICAgIDxCdWJibGVcbiAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9eyBhcmlhTGFiZWwgfVxuICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwiYnViYmxlXCJcbiAgICAgICAgICAgICAgICAgIGZyb21Vc2VyPXsgZnJvbVVzZXIgfVxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgIHsgY2hpbGRyZW4oe1xuICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eSxcbiAgICAgICAgICAgICAgICAgICAgYXR0YWNobWVudDoge1xuICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiB0ZXh0Rm9ybWF0VG9Db250ZW50VHlwZShhY3Rpdml0eS50ZXh0Rm9ybWF0KSxcbiAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBhY3Rpdml0eURpc3BsYXlUZXh0XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0pIH1cbiAgICAgICAgICAgICAgICA8L0J1YmJsZT5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZpbGxlclwiIC8+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIH1cbiAgICAgICAgICA8dWwgcmVmPXsgaXRlbUNvbnRhaW5lclJlZiB9PlxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBhY3Rpdml0eS5hdHRhY2htZW50cy5tYXAoKGF0dGFjaG1lbnQsIGluZGV4KSA9PlxuICAgICAgICAgICAgICAgIDxsaSBrZXk9eyBpbmRleCB9PlxuICAgICAgICAgICAgICAgICAgPEJ1YmJsZVxuICAgICAgICAgICAgICAgICAgICBmcm9tVXNlcj17IGZyb21Vc2VyIH1cbiAgICAgICAgICAgICAgICAgICAga2V5PXsgaW5kZXggfVxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICB7IGNoaWxkcmVuKHsgYXR0YWNobWVudCB9KSB9XG4gICAgICAgICAgICAgICAgICA8L0J1YmJsZT5cbiAgICAgICAgICAgICAgICA8L2xpPlxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9XG4gICAgICAgICAgPC91bD5cbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBhcmlhLWhpZGRlbj17IHRydWUgfVxuICAgICAgICAgICAgY2xhc3NOYW1lPVwid2ViY2hhdF9fcm93XCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICB7KFxuICAgICAgICAgICAgICBhY3Rpdml0eS5jaGFubmVsRGF0YVxuICAgICAgICAgICAgICAmJiAoXG4gICAgICAgICAgICAgICAgYWN0aXZpdHkuY2hhbm5lbERhdGEuc3RhdGUgPT09IFNFTkRJTkdcbiAgICAgICAgICAgICAgICB8fCBhY3Rpdml0eS5jaGFubmVsRGF0YS5zdGF0ZSA9PT0gU0VORF9GQUlMRURcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSA/XG4gICAgICAgICAgICAgIDxTZW5kU3RhdHVzIGFjdGl2aXR5PXsgYWN0aXZpdHkgfSAvPlxuICAgICAgICAgICAgOlxuICAgICAgICAgICAgICA8VGltZXN0YW1wXG4gICAgICAgICAgICAgICAgYWN0aXZpdHk9eyBhY3Rpdml0eSB9XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPXsgdGltZXN0YW1wQ2xhc3NOYW1lIH1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG4pXG5cbmV4cG9ydCBkZWZhdWx0IHByb3BzID0+XG4gIDxGaWxtQ29udGV4dC5Db25zdW1lcj5cbiAgICB7ICh7IGl0ZW1Db250YWluZXJSZWYsIHNjcm9sbGFibGVSZWYgfSkgPT5cbiAgICAgIDxDb25uZWN0ZWRDYXJvdXNlbEZpbG1TdHJpcFxuICAgICAgICBpdGVtQ29udGFpbmVyUmVmPXsgaXRlbUNvbnRhaW5lclJlZiB9XG4gICAgICAgIHNjcm9sbGFibGVSZWY9eyBzY3JvbGxhYmxlUmVmIH1cbiAgICAgICAgeyAuLi5wcm9wcyB9XG4gICAgICAvPlxuICAgIH1cbiAgPC9GaWxtQ29udGV4dC5Db25zdW1lcj5cblxuZXhwb3J0IHsgY29ubmVjdENhcm91c2VsRmlsbVN0cmlwIH1cbiJdfQ==