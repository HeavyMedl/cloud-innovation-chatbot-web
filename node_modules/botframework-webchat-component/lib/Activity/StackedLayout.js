"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.connectStackedLayout = exports.default = void 0;

var _glamor = require("glamor");

var _classnames = _interopRequireDefault(require("classnames"));

var _react = _interopRequireDefault(require("react"));

var _botframeworkWebchatCore = require("botframework-webchat-core");

var _Localize = require("../Localization/Localize");

var _Avatar = _interopRequireDefault(require("./Avatar"));

var _Bubble = _interopRequireDefault(require("./Bubble"));

var _connectToWebChat = _interopRequireDefault(require("../connectToWebChat"));

var _SendStatus = _interopRequireDefault(require("./SendStatus"));

var _textFormatToContentType = _interopRequireDefault(require("../Utils/textFormatToContentType"));

var _Timestamp = _interopRequireDefault(require("./Timestamp"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _Constants$ActivityCl = _botframeworkWebchatCore.Constants.ActivityClientState,
    SENDING = _Constants$ActivityCl.SENDING,
    SEND_FAILED = _Constants$ActivityCl.SEND_FAILED;
var ROOT_CSS = (0, _glamor.css)({
  display: 'flex',
  '& > .avatar': {
    flexShrink: 0
  },
  '& > .content': {
    flexGrow: 1,
    overflow: 'hidden',
    '& > .webchat__row': {
      display: 'flex',
      '& > .bubble, & > .timestamp': {
        flexGrow: 1,
        overflow: 'hidden'
      },
      '& > .filler': {
        flexGrow: 10000,
        flexShrink: 1
      }
    }
  },
  '& > .filler': {
    flexShrink: 0
  },
  '&.from-user': {
    flexDirection: 'row-reverse',
    '& > .content > .webchat__row': {
      flexDirection: 'row-reverse'
    }
  }
});

var connectStackedLayout = function connectStackedLayout() {
  for (var _len = arguments.length, selectors = new Array(_len), _key = 0; _key < _len; _key++) {
    selectors[_key] = arguments[_key];
  }

  return _connectToWebChat.default.apply(void 0, [function (_ref, _ref2) {
    var language = _ref.language,
        _ref$styleSet$options = _ref.styleSet.options,
        botAvatarInitials = _ref$styleSet$options.botAvatarInitials,
        userAvatarInitials = _ref$styleSet$options.userAvatarInitials;
    var activity = _ref2.activity;
    return {
      avatarInitials: activity.from && activity.from.role === 'user' ? userAvatarInitials : botAvatarInitials,
      language: language,
      // TODO: [P4] We want to deprecate botAvatarInitials/userAvatarInitials because they are not as helpful as avatarInitials
      botAvatarInitials: botAvatarInitials,
      userAvatarInitials: userAvatarInitials
    };
  }].concat(selectors));
};

exports.connectStackedLayout = connectStackedLayout;

var _default = connectStackedLayout(function (_ref3) {
  var avatarInitials = _ref3.avatarInitials,
      language = _ref3.language,
      styleSet = _ref3.styleSet;
  return {
    avatarInitials: avatarInitials,
    language: language,
    styleSet: styleSet
  };
})(function (_ref4) {
  var activity = _ref4.activity,
      avatarInitials = _ref4.avatarInitials,
      children = _ref4.children,
      language = _ref4.language,
      styleSet = _ref4.styleSet,
      timestampClassName = _ref4.timestampClassName;
  var fromUser = activity.from.role === 'user';

  var _ref5 = activity.channelData || {},
      state = _ref5.state;

  var showSendStatus = state === SENDING || state === SEND_FAILED;
  var ariaLabel = (0, _Localize.localize)(fromUser ? 'User said something' : 'Bot said something', language, avatarInitials, activity.text, activity.timestamp);
  var activityDisplayText = activity.channelData && activity.channelData.messageBack && activity.channelData.messageBack.displayText || activity.text;
  return _react.default.createElement("div", {
    className: (0, _classnames.default)(ROOT_CSS + '', styleSet.stackedLayout + '', {
      'from-user': fromUser
    })
  }, _react.default.createElement(_Avatar.default, {
    "aria-hidden": true,
    className: "avatar",
    fromUser: fromUser
  }), _react.default.createElement("div", {
    className: "content"
  }, activity.type === 'typing' ? _react.default.createElement("div", {
    className: "webchat__row typing"
  }, children({
    activity: activity,
    attachment: {
      contentType: 'typing'
    }
  }), _react.default.createElement("div", {
    className: "filler"
  })) : !!activityDisplayText && _react.default.createElement("div", {
    className: "webchat__row message"
  }, _react.default.createElement(_Bubble.default, {
    "aria-label": ariaLabel,
    className: "bubble",
    fromUser: fromUser
  }, children({
    activity: activity,
    attachment: {
      contentType: (0, _textFormatToContentType.default)(activity.textFormat),
      content: activityDisplayText
    }
  })), _react.default.createElement("div", {
    className: "filler"
  })), (activity.attachments || []).map(function (attachment, index) {
    return _react.default.createElement("div", {
      className: "webchat__row attachment",
      key: index
    }, _react.default.createElement(_Bubble.default, {
      className: "attachment bubble",
      fromUser: fromUser,
      key: index
    }, children({
      attachment: attachment
    })));
  }), _react.default.createElement("div", {
    "aria-hidden": true,
    className: "webchat__row"
  }, showSendStatus ? _react.default.createElement(_SendStatus.default, {
    activity: activity,
    className: "timestamp"
  }) : _react.default.createElement(_Timestamp.default, {
    activity: activity,
    className: (0, _classnames.default)('timestamp', timestampClassName)
  }), _react.default.createElement("div", {
    className: "filler"
  }))), _react.default.createElement("div", {
    className: "filler"
  }));
});

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9BY3Rpdml0eS9TdGFja2VkTGF5b3V0LmpzIl0sIm5hbWVzIjpbIkNvbnN0YW50cyIsIkFjdGl2aXR5Q2xpZW50U3RhdGUiLCJTRU5ESU5HIiwiU0VORF9GQUlMRUQiLCJST09UX0NTUyIsImRpc3BsYXkiLCJmbGV4U2hyaW5rIiwiZmxleEdyb3ciLCJvdmVyZmxvdyIsImZsZXhEaXJlY3Rpb24iLCJjb25uZWN0U3RhY2tlZExheW91dCIsInNlbGVjdG9ycyIsImNvbm5lY3RUb1dlYkNoYXQiLCJsYW5ndWFnZSIsInN0eWxlU2V0Iiwib3B0aW9ucyIsImJvdEF2YXRhckluaXRpYWxzIiwidXNlckF2YXRhckluaXRpYWxzIiwiYWN0aXZpdHkiLCJhdmF0YXJJbml0aWFscyIsImZyb20iLCJyb2xlIiwiY2hpbGRyZW4iLCJ0aW1lc3RhbXBDbGFzc05hbWUiLCJmcm9tVXNlciIsImNoYW5uZWxEYXRhIiwic3RhdGUiLCJzaG93U2VuZFN0YXR1cyIsImFyaWFMYWJlbCIsInRleHQiLCJ0aW1lc3RhbXAiLCJhY3Rpdml0eURpc3BsYXlUZXh0IiwibWVzc2FnZUJhY2siLCJkaXNwbGF5VGV4dCIsInN0YWNrZWRMYXlvdXQiLCJ0eXBlIiwiYXR0YWNobWVudCIsImNvbnRlbnRUeXBlIiwidGV4dEZvcm1hdCIsImNvbnRlbnQiLCJhdHRhY2htZW50cyIsIm1hcCIsImluZGV4Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7NEJBRTBEQSxrQyxDQUFsREMsbUI7SUFBdUJDLE8seUJBQUFBLE87SUFBU0MsVyx5QkFBQUEsVztBQUV4QyxJQUFNQyxRQUFRLEdBQUcsaUJBQUk7QUFDbkJDLEVBQUFBLE9BQU8sRUFBRSxNQURVO0FBR25CLGlCQUFlO0FBQ2JDLElBQUFBLFVBQVUsRUFBRTtBQURDLEdBSEk7QUFPbkIsa0JBQWdCO0FBQ2RDLElB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QUFBeUMsTUFBQSxHQUFHLEVBQUdBO0FBQS9DLE9BQ0UsNkJBQUMsZUFBRDtBQUNFLE1BQUEsU0FBUyxFQUFDLG1CQURaO0FBRUUsTUFBQSxRQUFRLEVBQUdsQixRQUZiO0FBR0UsTUFBQSxHQUFHLEVBQUdrQjtBQUhSLE9BS0lwQixRQUFRLENBQUM7QUFBRWMsTUFBQUEsVUFBVSxFQUFWQTtBQUFGLEtBQUQsQ0FMWixDQURGLENBRCtCO0FBQUEsR0FBakMsQ0FqQ0osRUE2Q0U7QUFDRSxtQkFBYyxJQURoQjtBQUVFLElBQUEsU0FBUyxFQUFDO0FBRlosS0FJSVQsY0FBYyxHQUNaLDZCQUFDLG1CQUFEO0FBQVksSUFBQSxRQUFRLEVBQUdULFFBQXZCO0FBQWtDLElBQUEsU0FBUyxFQUFDO0FBQTVDLElBRFksR0FHWiw2QkFBQyxrQkFBRDtBQUFXLElBQUEsUUFBUSxFQUFHQSxRQUF0QjtBQUFpQyxJQUFBLFNBQVMsRUFBRyx5QkFBVyxXQUFYLEVBQXdCSyxrQkFBeEI7QUFBN0MsSUFQTixFQVNFO0FBQUssSUFBQSxTQUFTLEVBQUM7QUFBZixJQVRGLENBN0NGLENBWkYsRUFxRUU7QUFBSyxJQUFBLFNBQVMsRUFBQztBQUFmLElBckVGLENBREY7QUF5RUQsQ0F2R1ksQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNzcyB9IGZyb20gJ2dsYW1vcic7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCB7IENvbnN0YW50cyB9IGZyb20gJ2JvdGZyYW1ld29yay13ZWJjaGF0LWNvcmUnO1xuXG5pbXBvcnQgeyBsb2NhbGl6ZSB9IGZyb20gJy4uL0xvY2FsaXphdGlvbi9Mb2NhbGl6ZSc7XG5pbXBvcnQgQXZhdGFyIGZyb20gJy4vQXZhdGFyJztcbmltcG9ydCBCdWJibGUgZnJvbSAnLi9CdWJibGUnO1xuaW1wb3J0IGNvbm5lY3RUb1dlYkNoYXQgZnJvbSAnLi4vY29ubmVjdFRvV2ViQ2hhdCc7XG5pbXBvcnQgU2VuZFN0YXR1cyBmcm9tICcuL1NlbmRTdGF0dXMnO1xuaW1wb3J0IHRleHRGb3JtYXRUb0NvbnRlbnRUeXBlIGZyb20gJy4uL1V0aWxzL3RleHRGb3JtYXRUb0NvbnRlbnRUeXBlJztcbmltcG9ydCBUaW1lc3RhbXAgZnJvbSAnLi9UaW1lc3RhbXAnO1xuXG5jb25zdCB7IEFjdGl2aXR5Q2xpZW50U3RhdGU6IHsgU0VORElORywgU0VORF9GQUlMRUQgfSB9ID0gQ29uc3RhbnRzO1xuXG5jb25zdCBST09UX0NTUyA9IGNzcyh7XG4gIGRpc3BsYXk6ICdmbGV4JyxcblxuICAnJiA+IC5hdmF0YXInOiB7XG4gICAgZmxleFNocmluazogMFxuICB9LFxuXG4gICcmID4gLmNvbnRlbnQnOiB7XG4gICAgZmxleEdyb3c6IDEsXG4gICAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxuXG4gICAgJyYgPiAud2ViY2hhdF9fcm93Jzoge1xuICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuXG4gICAgICAnJiA+IC5idWJibGUsICYgPiAudGltZXN0YW1wJzoge1xuICAgICAgICBmbGV4R3JvdzogMSxcbiAgICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nXG4gICAgICB9LFxuXG4gICAgICAnJiA+IC5maWxsZXInOiB7XG4gICAgICAgIGZsZXhHcm93OiAxMDAwMCxcbiAgICAgICAgZmxleFNocmluazogMVxuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICAnJiA+IC5maWxsZXInOiB7XG4gICAgZmxleFNocmluazogMFxuICB9LFxuXG4gICcmLmZyb20tdXNlcic6IHtcbiAgICBmbGV4RGlyZWN0aW9uOiAncm93LXJldmVyc2UnLFxuXG4gICAgJyYgPiAuY29udGVudCA+IC53ZWJjaGF0X19yb3cnOiB7XG4gICAgICBmbGV4RGlyZWN0aW9uOiAncm93LXJldmVyc2UnXG4gICAgfVxuICB9XG59KTtcblxuY29uc3QgY29ubmVjdFN0YWNrZWRMYXlvdXQgPSAoLi4uc2VsZWN0b3JzKSA9PiBjb25uZWN0VG9XZWJDaGF0KFxuICAoe1xuICAgIGxhbmd1YWdlLFxuICAgIHN0eWxlU2V0OiB7XG4gICAgICBvcHRpb25zOiB7XG4gICAgICAgIGJvdEF2YXRhckluaXRpYWxzLFxuICAgICAgICB1c2VyQXZhdGFySW5pdGlhbHNcbiAgICAgIH1cbiAgICB9XG4gIH0sIHsgYWN0aXZpdHkgfSkgPT4gKHtcbiAgICBhdmF0YXJJbml0aWFsczogYWN0aXZpdHkuZnJvbSAmJiBhY3Rpdml0eS5mcm9tLnJvbGUgPT09ICd1c2VyJyA/IHVzZXJBdmF0YXJJbml0aWFscyA6IGJvdEF2YXRhckluaXRpYWxzLFxuICAgIGxhbmd1YWdlLFxuXG4gICAgLy8gVE9ETzogW1A0XSBXZSB3YW50IHRvIGRlcHJlY2F0ZSBib3RBdmF0YXJJbml0aWFscy91c2VyQXZhdGFySW5pdGlhbHMgYmVjYXVzZSB0aGV5IGFyZSBub3QgYXMgaGVscGZ1bCBhcyBhdmF0YXJJbml0aWFsc1xuICAgIGJvdEF2YXRhckluaXRpYWxzLFxuICAgIHVzZXJBdmF0YXJJbml0aWFsc1xuICB9KSxcbiAgLi4uc2VsZWN0b3JzXG4pO1xuXG5leHBvcnQgZGVmYXVsdCBjb25uZWN0U3RhY2tlZExheW91dChcbiAgKHtcbiAgICBhdmF0YXJJbml0aWFscyxcbiAgICBsYW5ndWFnZSxcbiAgICBzdHlsZVNldFxuICB9KSA9PiAoe1xuICAgIGF2YXRhckluaXRpYWxzLFxuICAgIGxhbmd1YWdlLFxuICAgIHN0eWxlU2V0XG4gIH0pXG4pKFxuICAoe1xuICAgIGFjdGl2aXR5LFxuICAgIGF2YXRhckluaXRpYWxzLFxuICAgIGNoaWxkcmVuLFxuICAgIGxhbmd1YWdlLFxuICAgIHN0eWxlU2V0LFxuICAgIHRpbWVzdGFtcENsYXNzTmFtZVxuICB9KSA9PiB7XG4gICAgY29uc3QgZnJvbVVzZXIgPSBhY3Rpdml0eS5mcm9tLnJvbGUgPT09ICd1c2VyJztcbiAgICBjb25zdCB7IHN0YXRlIH0gPSBhY3Rpdml0eS5jaGFubmVsRGF0YSB8fCB7fTtcbiAgICBjb25zdCBzaG93U2VuZFN0YXR1cyA9IHN0YXRlID09PSBTRU5ESU5HIHx8IHN0YXRlID09PSBTRU5EX0ZBSUxFRDtcbiAgICBjb25zdCBhcmlhTGFiZWwgPSBsb2NhbGl6ZShmcm9tVXNlciA/ICdVc2VyIHNhaWQgc29tZXRoaW5nJyA6ICdCb3Qgc2FpZCBzb21ldGhpbmcnLCBsYW5ndWFnZSwgYXZhdGFySW5pdGlhbHMsIGFjdGl2aXR5LnRleHQsIGFjdGl2aXR5LnRpbWVzdGFtcCk7XG4gICAgY29uc3QgYWN0aXZpdHlEaXNwbGF5VGV4dCA9XG4gICAgICAoXG4gICAgICAgIGFjdGl2aXR5LmNoYW5uZWxEYXRhXG4gICAgICAgICYmIGFjdGl2aXR5LmNoYW5uZWxEYXRhLm1lc3NhZ2VCYWNrXG4gICAgICAgICYmIGFjdGl2aXR5LmNoYW5uZWxEYXRhLm1lc3NhZ2VCYWNrLmRpc3BsYXlUZXh0XG4gICAgICApIHx8IGFjdGl2aXR5LnRleHQ7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICBjbGFzc05hbWU9eyBjbGFzc05hbWVzKFxuICAgICAgICAgIFJPT1RfQ1NTICsgJycsXG4gICAgICAgICAgc3R5bGVTZXQuc3RhY2tlZExheW91dCArICcnLFxuICAgICAgICAgIHsgJ2Zyb20tdXNlcic6IGZyb21Vc2VyIH1cbiAgICAgICAgKSB9XG4gICAgICA+XG4gICAgICAgIDxBdmF0YXJcbiAgICAgICAgICBhcmlhLWhpZGRlbj17IHRydWUgfVxuICAgICAgICAgIGNsYXNzTmFtZT1cImF2YXRhclwiXG4gICAgICAgICAgZnJvbVVzZXI9eyBmcm9tVXNlciB9XG4gICAgICAgIC8+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY29udGVudFwiPlxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGFjdGl2aXR5LnR5cGUgPT09ICd0eXBpbmcnID9cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3ZWJjaGF0X19yb3cgdHlwaW5nXCI+XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgY2hpbGRyZW4oe1xuICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eSxcbiAgICAgICAgICAgICAgICAgICAgYXR0YWNobWVudDogeyBjb250ZW50VHlwZTogJ3R5cGluZycgfVxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmaWxsZXJcIiAvPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDogISFhY3Rpdml0eURpc3BsYXlUZXh0ICYmXG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwid2ViY2hhdF9fcm93IG1lc3NhZ2VcIj5cbiAgICAgICAgICAgICAgICA8QnViYmxlXG4gICAgICAgICAgICAgICAgICBhcmlhLWxhYmVsPXsgYXJpYUxhYmVsIH1cbiAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cImJ1YmJsZVwiXG4gICAgICAgICAgICAgICAgICBmcm9tVXNlcj17IGZyb21Vc2VyIH1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuKHtcbiAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eSxcbiAgICAgICAgICAgICAgICAgICAgICBhdHRhY2htZW50OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogdGV4dEZvcm1hdFRvQ29udGVudFR5cGUoYWN0aXZpdHkudGV4dEZvcm1hdCksXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBhY3Rpdml0eURpc3BsYXlUZXh0XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIDwvQnViYmxlPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmlsbGVyXCIgLz5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgfVxuICAgICAgICAgIHtcbiAgICAgICAgICAgIChhY3Rpdml0eS5hdHRhY2htZW50cyB8fCBbXSkubWFwKChhdHRhY2htZW50LCBpbmRleCkgPT5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3ZWJjaGF0X19yb3cgYXR0YWNobWVudFwiIGtleT17IGluZGV4IH0+XG4gICAgICAgICAgICAgICAgPEJ1YmJsZVxuICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwiYXR0YWNobWVudCBidWJibGVcIlxuICAgICAgICAgICAgICAgICAgZnJvbVVzZXI9eyBmcm9tVXNlciB9XG4gICAgICAgICAgICAgICAgICBrZXk9eyBpbmRleCB9XG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgeyBjaGlsZHJlbih7IGF0dGFjaG1lbnQgfSkgfVxuICAgICAgICAgICAgICAgIDwvQnViYmxlPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIClcbiAgICAgICAgICB9XG4gICAgICAgICAgPGRpdlxuICAgICAgICAgICAgYXJpYS1oaWRkZW49eyB0cnVlIH1cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cIndlYmNoYXRfX3Jvd1wiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgeyBzaG93U2VuZFN0YXR1cyA/XG4gICAgICAgICAgICAgICAgPFNlbmRTdGF0dXMgYWN0aXZpdHk9eyBhY3Rpdml0eSB9IGNsYXNzTmFtZT1cInRpbWVzdGFtcFwiIC8+XG4gICAgICAgICAgICAgIDpcbiAgICAgICAgICAgICAgICA8VGltZXN0YW1wIGFjdGl2aXR5PXsgYWN0aXZpdHkgfSBjbGFzc05hbWU9eyBjbGFzc05hbWVzKCd0aW1lc3RhbXAnLCB0aW1lc3RhbXBDbGFzc05hbWUpIH0gLz5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmlsbGVyXCIgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmlsbGVyXCIgLz5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbilcblxuZXhwb3J0IHsgY29ubmVjdFN0YWNrZWRMYXlvdXQgfVxuIl19