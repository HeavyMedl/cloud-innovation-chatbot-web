"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _reactScrollToBottom = require("react-scroll-to-bottom");

var _reactRedux = require("react-redux");

var _glamor = require("glamor");

var _memoizeOne = _interopRequireDefault(require("memoize-one"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _botframeworkWebchatCore = require("botframework-webchat-core");

var _concatMiddleware = _interopRequireDefault(require("./Middleware/concatMiddleware"));

var _Context = _interopRequireDefault(require("./Context"));

var _createCoreMiddleware = _interopRequireDefault(require("./Middleware/CardAction/createCoreMiddleware"));

var _createStyleSet = _interopRequireDefault(require("./Styles/createStyleSet"));

var _adaptiveCardHostConfig = _interopRequireDefault(require("./Styles/adaptiveCardHostConfig"));

var _Dictation = _interopRequireDefault(require("./Dictation"));

var _mapMap = _interopRequireDefault(require("./Utils/mapMap"));

var _observableToPromise = _interopRequireDefault(require("./Utils/observableToPromise"));

var _shallowEquals = _interopRequireDefault(require("./Utils/shallowEquals"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }

function _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }

// Flywheel object
var EMPTY_ARRAY = [];
var DISPATCHERS = {
  markActivity: _botframeworkWebchatCore.markActivity,
  postActivity: _botframeworkWebchatCore.postActivity,
  sendEvent: _botframeworkWebchatCore.sendEvent,
  sendFiles: _botframeworkWebchatCore.sendFiles,
  sendMessage: _botframeworkWebchatCore.sendMessage,
  sendMessageBack: _botframeworkWebchatCore.sendMessageBack,
  sendPostBack: _botframeworkWebchatCore.sendPostBack,
  setDictateInterims: _botframeworkWebchatCore.setDictateInterims,
  setDictateState: _botframeworkWebchatCore.setDictateState,
  setSendBox: _botframeworkWebchatCore.setSendBox,
  setSendTimeout: _botframeworkWebchatCore.setSendTimeout,
  startDictate: _botframeworkWebchatCore.startDictate,
  startSpeakingActivity: _botframeworkWebchatCore.startSpeakingActivity,
  stopDictate: _botframeworkWebchatCore.stopDictate,
  stopSpeakingActivity: _botframeworkWebchatCore.stopSpeakingActivity,
  submitSendBox: _botframeworkWebchatCore.submitSendBox
};

function styleSetToClassNames(styleSet) {
  return (0, _mapMap.default)(styleSet, function (style, key) {
    return key === 'options' ? style : (0, _glamor.css)(style);
  });
}

function createCardActionLogic(_ref) {
  var cardActionMiddleware = _ref.cardActionMiddleware,
      directLine = _ref.directLine,
      dispatch = _ref.dispatch;
  var runMiddleware = (0, _concatMiddleware.default)(cardActionMiddleware, (0, _createCoreMiddleware.default)())({
    dispatch: dispatch
  });
  return {
    onCardAction: function onCardAction(cardAction) {
      return runMiddleware(function (_ref2) {
        var type = _ref2.cardAction.type;
        throw new Error("Web Chat: received unknown card action \"".concat(type, "\""));
      })({
        cardAction: cardAction,
        getSignInUrl: cardAction.type === 'signin' ? function () {
          var value = cardAction.value;

          if (directLine.getSessionId) {
            // TODO: [P3] We should change this one to async/await.
            //       This is the first place in this project to use async.
            //       Thus, we need to add @babel/plugin-transform-runtime and @babel/runtime.
            return (0, _observableToPromise.default)(directLine.getSessionId()).then(function (sessionId) {
              return "".concat(value).concat(encodeURIComponent("&code_challenge=".concat(sessionId)));
            });
          } else {
            return value;
          }
        } : null
      });
    }
  };
}

function createFocusSendBoxLogic(_ref3) {
  var sendBoxRef = _ref3.sendBoxRef;
  return {
    focusSendBox: function focusSendBox() {
      var _ref4 = sendBoxRef || {},
          current = _ref4.current;

      current && current.focus();
    }
  };
}

function createStyleSetLogic(_ref5) {
  var styleOptions = _ref5.styleOptions,
      styleSet = _ref5.styleSet;
  return {
    styleSet: styleSetToClassNames(styleSet || (0, _createStyleSet.default)(styleOptions))
  };
} // TODO: [P3] Take this deprecation code out when releasing on or after 2019 December 11


function patchPropsForAvatarInitials(_ref6) {
  var botAvatarInitials = _ref6.botAvatarInitials,
      userAvatarInitials = _ref6.userAvatarInitials,
      props = _objectWithoutProperties(_ref6, ["botAvatarInitials", "userAvatarInitials"]);

  // This code will take out "botAvatarInitials" and "userAvatarInitials" from props
  var styleOptions = props.styleOptions;

  if (botAvatarInitials) {
    styleOptions = _objectSpread({}, styleOptions, {
      botAvatarInitials: botAvatarInitials
    });
    console.warn('Web Chat: "botAvatarInitials" is deprecated. Please use "styleOptions.botAvatarInitials" instead. "botAvatarInitials" will be removed on or after December 11 2019 .');
  }

  if (userAvatarInitials) {
    styleOptions = _objectSpread({}, styleOptions, {
      userAvatarInitials: userAvatarInitials
    });
    console.warn('Web Chat: "botAvatarInitials" is deprecated. Please use "styleOptions.botAvatarInitials" instead. "botAvatarInitials" will be removed on or after December 11 2019 .');
  }

  return _objectSpread({}, props, {
    styleOptions: styleOptions
  });
}

function createLogic(props) {
  // This is a heavy function, and it is expected to be only called when there is a need to recreate business logic, e.g.
  // - User ID changed, causing all send* functions to be updated
  // - send
  // TODO: [P4] We should break this into smaller pieces using memoization function, so we don't recreate styleSet if userID is changed
  // TODO: [P3] We should think about if we allow the user to change onSendBoxValueChanged/sendBoxValue, e.g.
  // 1. Turns text into UPPERCASE
  // 2. Filter out profanity
  // TODO: [P4] Revisit all members of context
  props = patchPropsForAvatarInitials(props);
  return _objectSpread({}, props, createCardActionLogic(props), createFocusSendBoxLogic(props), createStyleSetLogic(props));
}

var Composer =
/*#__PURE__*/
function (_React$Component) {
  _inherits(Composer, _React$Component);

  function Composer(props) {
    var _this;

    _classCallCheck(this, Composer);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(Composer).call(this, props));
    _this.createContextFromProps = (0, _memoizeOne.default)(createLogic, _shallowEquals.default);
    _this.createWebSpeechPonyfill = (0, _memoizeOne.default)(function (webSpeechPonyfillFactory, referenceGrammarID) {
      return webSpeechPonyfillFactory && webSpeechPonyfillFactory({
        referenceGrammarID: referenceGrammarID
      });
    });
    _this.mergeContext = (0, _memoizeOne.default)(function () {
      for (var _len = arguments.length, contexts = new Array(_len), _key = 0; _key < _len; _key++) {
        contexts[_key] = arguments[_key];
      }

      return Object.assign.apply(Object, [{}].concat(contexts));
    }, _shallowEquals.default);
    _this.state = {
      hoistedDispatchers: (0, _mapMap.default)(DISPATCHERS, function (dispatcher) {
        return function () {
          for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
            args[_key2] = arguments[_key2];
          }

          return _this.props.dispatch(dispatcher.apply(_assertThisInitialized(_this), args));
        };
      })
    };
    return _this;
  }

  _createClass(Composer, [{
    key: "componentWillMount",
    value: function componentWillMount() {
      var props = this.props;
      var directLine = props.directLine,
          userID = props.userID,
          username = props.username;
      this.setLanguageFromProps(props);
      this.setSendTimeoutFromProps(props);
      this.setSendTypingIndicatorFromProps(props);
      props.dispatch((0, _botframeworkWebchatCore.connect)({
        directLine: directLine,
        userID: userID,
        username: username
      }));
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      var props = this.props;
      var directLine = props.directLine,
          locale = props.locale,
          sendTimeout = props.sendTimeout,
          sendTyping = props.sendTyping,
          sendTypingIndicator = props.sendTypingIndicator,
          userID = props.userID,
          username = props.username;

      if (prevProps.locale !== locale) {
        this.setLanguageFromProps(props);
      }

      if (prevProps.sendTimeout !== sendTimeout) {
        this.setSendTimeoutFromProps(props);
      }

      if (!prevProps.sendTypingIndicator !== !sendTypingIndicator // TODO: [P3] Take this deprecation code out when releasing on or after January 13 2020
      || !prevProps.sendTyping !== !sendTyping) {
        this.setSendTypingIndicatorFromProps(props);
      }

      if (prevProps.directLine !== directLine || prevProps.userID !== userID || prevProps.username !== username) {
        // TODO: [P3] disconnect() is an async call (pending -> fulfilled), we need to wait, or change it to reconnect()
        props.dispatch((0, _botframeworkWebchatCore.disconnect)());
        props.dispatch((0, _botframeworkWebchatCore.connect)({
          directLine: directLine,
          userID: userID,
          username: username
        }));
      }
    }
  }, {
    key: "setLanguageFromProps",
    value: function setLanguageFromProps(props) {
      props.dispatch((0, _botframeworkWebchatCore.setLanguage)(props.locale || window.navigator.language || 'en-US'));
    }
  }, {
    key: "setSendTimeoutFromProps",
    value: function setSendTimeoutFromProps(props) {
      props.dispatch((0, _botframeworkWebchatCore.setSendTimeout)(props.sendTimeout || 20000));
    }
  }, {
    key: "setSendTypingIndicatorFromProps",
    value: function setSendTypingIndicatorFromProps(props) {
      if (typeof props.sendTyping === 'undefined') {
        props.dispatch((0, _botframeworkWebchatCore.setSendTypingIndicator)(!!props.sendTypingIndicator));
      } else {
        // TODO: [P3] Take this deprecation code out when releasing on or after January 13 2020
        console.warn('Web Chat: "sendTyping" has been renamed to "sendTypingIndicator". Please use "sendTypingIndicator" instead. This deprecation migration will be removed on or after January 13 2020.');
        props.dispatch((0, _botframeworkWebchatCore.setSendTypingIndicator)(!!props.sendTyping));
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props = this.props,
          activityRenderer = _this$props.activityRenderer,
          adaptiveCardHostConfig = _this$props.adaptiveCardHostConfig,
          attachmentRenderer = _this$props.attachmentRenderer,
          children = _this$props.children,
          disabled = _this$props.disabled,
          grammars = _this$props.grammars,
          groupTimestamp = _this$props.groupTimestamp,
          referenceGrammarID = _this$props.referenceGrammarID,
          renderMarkdown = _this$props.renderMarkdown,
          scrollToEnd = _this$props.scrollToEnd,
          store = _this$props.store,
          userID = _this$props.userID,
          username = _this$props.username,
          webSpeechPonyfillFactory = _this$props.webSpeechPonyfillFactory,
          propsForLogic = _objectWithoutProperties(_this$props, ["activityRenderer", "adaptiveCardHostConfig", "attachmentRenderer", "children", "disabled", "grammars", "groupTimestamp", "referenceGrammarID", "renderMarkdown", "scrollToEnd", "store", "userID", "username", "webSpeechPonyfillFactory"]),
          state = this.state;

      var contextFromProps = this.createContextFromProps(propsForLogic);
      var context = this.mergeContext(contextFromProps, state.hoistedDispatchers, // TODO: [P4] Should we normalize empties here? Or should we let it thru?
      //       If we let it thru, the code below become simplified and the user can plug in whatever they want for context, via Composer.props
      {
        activityRenderer: activityRenderer,
        adaptiveCardHostConfig: adaptiveCardHostConfig || (0, _adaptiveCardHostConfig.default)(this.props.styleOptions),
        attachmentRenderer: attachmentRenderer,
        groupTimestamp: groupTimestamp,
        disabled: disabled,
        grammars: grammars || EMPTY_ARRAY,
        renderMarkdown: renderMarkdown,
        scrollToEnd: scrollToEnd,
        store: store,
        webSpeechPonyfill: this.createWebSpeechPonyfill(webSpeechPonyfillFactory, referenceGrammarID)
      }); // TODO: [P3] Check how many times we do re-render context

      return _react.default.createElement(_Context.default.Provider, {
        value: context
      }, typeof children === 'function' ? children(context) : children, _react.default.createElement(_Dictation.default, null));
    }
  }]);

  return Composer;
}(_react.default.Component);

var ConnectedComposer = (0, _reactRedux.connect)(function (_ref7) {
  var referenceGrammarID = _ref7.referenceGrammarID;
  return {
    referenceGrammarID: referenceGrammarID
  };
})(function (props) {
  return _react.default.createElement(_reactScrollToBottom.Composer, null, _react.default.createElement(_reactScrollToBottom.FunctionContext.Consumer, null, function (_ref8) {
    var scrollToEnd = _ref8.scrollToEnd;
    return _react.default.createElement(Composer, _extends({
      scrollToEnd: scrollToEnd
    }, props));
  }));
}); // We will create a Redux store if it was not passed in

var ConnectedComposerWithStore =
/*#__PURE__*/
function (_React$Component2) {
  _inherits(ConnectedComposerWithStore, _React$Component2);

  function ConnectedComposerWithStore(props) {
    var _this2;

    _classCallCheck(this, ConnectedComposerWithStore);

    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(ConnectedComposerWithStore).call(this, props));
    _this2.createMemoizedStore = (0, _memoizeOne.default)(function () {
      return (0, _botframeworkWebchatCore.createStore)();
    });
    return _this2;
  }

  _createClass(ConnectedComposerWithStore, [{
    key: "render",
    value: function render() {
      var props = this.props;
      return _react.default.createElement(ConnectedComposer, _extends({}, props, {
        store: props.store || this.createMemoizedStore()
      }));
    }
  }]);

  return ConnectedComposerWithStore;
}(_react.default.Component);

var _default = ConnectedComposerWithStore; // TODO: [P3] We should consider moving some props to Redux store
//       Although we use `connectToWebChat` to hide the details of accessor of Redux store,
//       we should clean up the responsibility between Context and Redux store
//       We should decide which data is needed for React but not in other environment such as CLI/VSCode

exports.default = _default;
ConnectedComposerWithStore.propTypes = {
  activityRenderer: _propTypes.default.func,
  adaptiveCardHostConfig: _propTypes.default.any,
  attachmentRenderer: _propTypes.default.func,
  cardActionMiddleware: _propTypes.default.func,
  groupTimestamp: _propTypes.default.oneOfType([_propTypes.default.bool, _propTypes.default.number]),
  disabled: _propTypes.default.bool,
  grammars: _propTypes.default.arrayOf(_propTypes.default.string),
  renderMarkdown: _propTypes.default.func,
  sendTimeout: _propTypes.default.number,
  sendTypingIndicator: _propTypes.default.bool,
  store: _propTypes.default.any,
  userID: _propTypes.default.string,
  username: _propTypes.default.string,
  webSpeechPonyfillFactory: _propTypes.default.func
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Db21wb3Nlci5qcyJdLCJuYW1lcyI6WyJFTVBUWV9BUlJBWSIsIkRJU1BBVENIRVJTIiwibWFya0FjdGl2aXR5IiwicG9zdEFjdGl2aXR5Iiwic2VuZEV2ZW50Iiwic2VuZEZpbGVzIiwic2VuZE1lc3NhZ2UiLCJzZW5kTWVzc2FnZUJhY2siLCJzZW5kUG9zdEJhY2siLCJzZXREaWN0YXRlSW50ZXJpbXMiLCJzZXREaWN0YXRlU3RhdGUiLCJzZXRTZW5kQm94Iiwic2V0U2VuZFRpbWVvdXQiLCJzdGFydERpY3RhdGUiLCJzdGFydFNwZWFraW5nQWN0aXZpdHkiLCJzdG9wRGljdGF0ZSIsInN0b3BTcGVha2luZ0FjdGl2aXR5Iiwic3VibWl0U2VuZEJveCIsInN0eWxlU2V0VG9DbGFzc05hbWVzIiwic3R5bGVTZXQiLCJzdHlsZSIsImtleSIsImNyZWF0ZUNhcmRBY3Rpb25Mb2dpYyIsImNhcmRBY3Rpb25NaWRkbGV3YXJlIiwiZGlyZWN0TGluZSIsImRpc3BhdGNoIiwicnVuTWlkZGxld2FyZSIsIm9uQ2FyZEFjdGlvbiIsImNhcmRBY3Rpb24iLCJ0eXBlIiwiRXJyb3IiLCJnZXRTaWduSW5VcmwiLCJ2YWx1ZSIsImdldFNlc3Npb25JZCIsInRoZW4iLCJzZXNzaW9uSWQiLCJlbmNvZGVVUklDb21wb25lbnQiLCJjcmVhdGVGb2N1c1NlbmRCb3hMb2dpYyIsInNlbmRCb3hSZWYiLCJmb2N1c1NlbmRCb3giLCJjdXJyZW50IiwiZm9jdXMiLCJjcmVhdGVTdHlsZVNldExvZ2ljIiwic3R5bGVPcHRpb25zIiwicGF0Y2hQcm9wc0ZvckF2YXRhckluaXRpYWxzIiwiYm90QXZhdGFySW5pdGlhbHMiLCJ1c2VyQXZhdGFySW5pdGlhbHMiLCJwcm9wcyIsImNvbnNvbGUiLCJ3YXJuIiwiY3JlYXRlTG9naWMiLCJDb21wb3NlciIsImNyZWF0ZUNvbnRleHRGcm9tUHJvcHMiLCJzaGFsbG93RXF1YWxzIiwiY3JlYXRlV2ViU3BlZWNoUG9ueWZpbGwiLCJ3ZWJTcGVlY2hQb255ZmlsbEZhY3RvcnkiLCJyZWZlcmVuY2VHcmFtbWFySUQiLCJtZXJnZUNvbnRleHQiLCJjb250ZXh0cyIsIk9iamVjdCIsImFzc2lnbiIsInN0YXRlIiwiaG9pc3RlZERpc3BhdGNoZXJzIiwiZGlzcGF0Y2hlciIsImFyZ3MiLCJhcHBseSIsInVzZXJJRCIsInVzZXJuYW1lIiwic2V0TGFuZ3VhZ2VGcm9tUHJvcHMiLCJzZXRTZW5kVGltZW91dEZyb21Qcm9wcyIsInNldFNlbmRUeXBpbmdJbmRpY2F0b3JGcm9tUHJvcHMiLCJwcmV2UHJvcHMiLCJsb2NhbGUiLCJzZW5kVGltZW91dCIsInNlbmRUeXBpbmciLCJzZW5kVHlwaW5nSW5kaWNhdG9yIiwid2luZG93IiwibmF2aWdhdG9yIiwibGFuZ3VhZ2UiLCJhY3Rpdml0eVJlbmRlcmVyIiwiYWRhcHRpdmVDYXJkSG9zdENvbmZpZyIsImF0dGFjaG1lbnRSZW5kZXJlciIsImNoaWxkcmVuIiwiZGlzYWJsZWQiLCJncmFtbWFycyIsImdyb3VwVGltZXN0YW1wIiwicmVuZGVyTWFya2Rvd24iLCJzY3JvbGxUb0VuZCIsInN0b3JlIiwicHJvcHNGb3JMb2dpYyIsImNvbnRleHRGcm9tUHJvcHMiLCJjb250ZXh0Iiwid2ViU3BlZWNoUG9ueWZpbGwiLCJSZWFjdCIsIkNvbXBvbmVudCIsIkNvbm5lY3RlZENvbXBvc2VyIiwiQ29ubmVjdGVkQ29tcG9zZXJXaXRoU3RvcmUiLCJjcmVhdGVNZW1vaXplZFN0b3JlIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwiZnVuYyIsImFueSIsIm9uZU9mVHlwZSIsImJvb2wiLCJudW1iZXIiLCJhcnJheU9mIiwic3RyaW5nIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBS0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBd0JBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBO0FB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LEVBRWY7QUFDQTtBQUNBO0FBQ0E7OztBQUNBQSwwQkFBMEIsQ0FBQ0UsU0FBM0IsR0FBdUM7QUFDckNuQixFQUFBQSxnQkFBZ0IsRUFBRW9CLG1CQUFVQyxJQURTO0FBRXJDcEIsRUFBQUEsc0JBQXNCLEVBQUVtQixtQkFBVUUsR0FGRztBQUdyQ3BCLEVBQUFBLGtCQUFrQixFQUFFa0IsbUJBQVVDLElBSE87QUFJckM3RSxFQUFBQSxvQkFBb0IsRUFBRTRFLG1CQUFVQyxJQUpLO0FBS3JDZixFQUFBQSxjQUFjLEVBQUVjLG1CQUFVRyxTQUFWLENBQW9CLENBQUNILG1CQUFVSSxJQUFYLEVBQWlCSixtQkFBVUssTUFBM0IsQ0FBcEIsQ0FMcUI7QUFNckNyQixFQUFBQSxRQUFRLEVBQUVnQixtQkFBVUksSUFOaUI7QUFPckNuQixFQUFBQSxRQUFRLEVBQUVlLG1CQUFVTSxPQUFWLENBQWtCTixtQkFBVU8sTUFBNUIsQ0FQMkI7QUFRckNwQixFQUFBQSxjQUFjLEVBQUVhLG1CQUFVQyxJQVJXO0FBU3JDM0IsRUFBQUEsV0FBVyxFQUFFMEIsbUJBQVVLLE1BVGM7QUFVckM3QixFQUFBQSxtQkFBbUIsRUFBRXdCLG1CQUFVSSxJQVZNO0FBV3JDZixFQUFBQSxLQUFLLEVBQUVXLG1CQUFVRSxHQVhvQjtBQVlyQ25DLEVBQUFBLE1BQU0sRUFBRWlDLG1CQUFVTyxNQVptQjtBQWFyQ3ZDLEVBQUFBLFFBQVEsRUFBRWdDLG1CQUFVTyxNQWJpQjtBQWNyQ25ELEVBQUFBLHdCQUF3QixFQUFFNEMsbUJBQVVDO0FBZEMsQ0FBdkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb3NlciBhcyBTY3JvbGxUb0JvdHRvbUNvbXBvc2VyLFxuICBGdW5jdGlvbkNvbnRleHQgYXMgU2Nyb2xsVG9Cb3R0b21GdW5jdGlvbkNvbnRleHRcbn0gZnJvbSAncmVhY3Qtc2Nyb2xsLXRvLWJvdHRvbSc7XG5cbmltcG9ydCB7IGNvbm5lY3QgfSBmcm9tICdyZWFjdC1yZWR1eCc7XG5pbXBvcnQgeyBjc3MgfSBmcm9tICdnbGFtb3InO1xuaW1wb3J0IG1lbW9pemUgZnJvbSAnbWVtb2l6ZS1vbmUnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCB7XG4gIGNvbm5lY3QgYXMgY3JlYXRlQ29ubmVjdEFjdGlvbixcbiAgY3JlYXRlU3RvcmUsXG4gIGRpc2Nvbm5lY3QsXG4gIG1hcmtBY3Rpdml0eSxcbiAgcG9zdEFjdGl2aXR5LFxuICBzZW5kRXZlbnQsXG4gIHNlbmRGaWxlcyxcbiAgc2VuZE1lc3NhZ2UsXG4gIHNlbmRNZXNzYWdlQmFjayxcbiAgc2VuZFBvc3RCYWNrLFxuICBzZXREaWN0YXRlSW50ZXJpbXMsXG4gIHNldERpY3RhdGVTdGF0ZSxcbiAgc2V0TGFuZ3VhZ2UsXG4gIHNldFNlbmRCb3gsXG4gIHNldFNlbmRUaW1lb3V0LFxuICBzZXRTZW5kVHlwaW5nSW5kaWNhdG9yLFxuICBzdGFydERpY3RhdGUsXG4gIHN0YXJ0U3BlYWtpbmdBY3Rpdml0eSxcbiAgc3RvcERpY3RhdGUsXG4gIHN0b3BTcGVha2luZ0FjdGl2aXR5LFxuICBzdWJtaXRTZW5kQm94XG59IGZyb20gJ2JvdGZyYW1ld29yay13ZWJjaGF0LWNvcmUnO1xuXG5pbXBvcnQgY29uY2F0TWlkZGxld2FyZSBmcm9tICcuL01pZGRsZXdhcmUvY29uY2F0TWlkZGxld2FyZSc7XG5pbXBvcnQgQ29udGV4dCBmcm9tICcuL0NvbnRleHQnO1xuaW1wb3J0IGNyZWF0ZUNvcmVDYXJkQWN0aW9uTWlkZGxld2FyZSBmcm9tICcuL01pZGRsZXdhcmUvQ2FyZEFjdGlvbi9jcmVhdGVDb3JlTWlkZGxld2FyZSc7XG5pbXBvcnQgY3JlYXRlU3R5bGVTZXQgZnJvbSAnLi9TdHlsZXMvY3JlYXRlU3R5bGVTZXQnO1xuaW1wb3J0IGRlZmF1bHRBZGFwdGl2ZUNhcmRIb3N0Q29uZmlnIGZyb20gJy4vU3R5bGVzL2FkYXB0aXZlQ2FyZEhvc3RDb25maWcnO1xuaW1wb3J0IERpY3RhdGlvbiBmcm9tICcuL0RpY3RhdGlvbic7XG5pbXBvcnQgbWFwTWFwIGZyb20gJy4vVXRpbHMvbWFwTWFwJztcbmltcG9ydCBvYnNlcnZhYmxlVG9Qcm9taXNlIGZyb20gJy4vVXRpbHMvb2JzZXJ2YWJsZVRvUHJvbWlzZSc7XG5pbXBvcnQgc2hhbGxvd0VxdWFscyBmcm9tICcuL1V0aWxzL3NoYWxsb3dFcXVhbHMnO1xuXG4vLyBGbHl3aGVlbCBvYmplY3RcbmNvbnN0IEVNUFRZX0FSUkFZID0gW107XG5cbmNvbnN0IERJU1BBVENIRVJTID0ge1xuICBtYXJrQWN0aXZpdHksXG4gIHBvc3RBY3Rpdml0eSxcbiAgc2VuZEV2ZW50LFxuICBzZW5kRmlsZXMsXG4gIHNlbmRNZXNzYWdlLFxuICBzZW5kTWVzc2FnZUJhY2ssXG4gIHNlbmRQb3N0QmFjayxcbiAgc2V0RGljdGF0ZUludGVyaW1zLFxuICBzZXREaWN0YXRlU3RhdGUsXG4gIHNldFNlbmRCb3gsXG4gIHNldFNlbmRUaW1lb3V0LFxuICBzdGFydERpY3RhdGUsXG4gIHN0YXJ0U3BlYWtpbmdBY3Rpdml0eSxcbiAgc3RvcERpY3RhdGUsXG4gIHN0b3BTcGVha2luZ0FjdGl2aXR5LFxuICBzdWJtaXRTZW5kQm94XG59O1xuXG5mdW5jdGlvbiBzdHlsZVNldFRvQ2xhc3NOYW1lcyhzdHlsZVNldCkge1xuICByZXR1cm4gbWFwTWFwKHN0eWxlU2V0LCAoc3R5bGUsIGtleSkgPT4ga2V5ID09PSAnb3B0aW9ucycgPyBzdHlsZSA6IGNzcyhzdHlsZSkpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVDYXJkQWN0aW9uTG9naWMoeyBjYXJkQWN0aW9uTWlkZGxld2FyZSwgZGlyZWN0TGluZSwgZGlzcGF0Y2ggfSkge1xuICBjb25zdCBydW5NaWRkbGV3YXJlID0gY29uY2F0TWlkZGxld2FyZShjYXJkQWN0aW9uTWlkZGxld2FyZSwgY3JlYXRlQ29yZUNhcmRBY3Rpb25NaWRkbGV3YXJlKCkpKHsgZGlzcGF0Y2ggfSk7XG5cbiAgcmV0dXJuIHtcbiAgICBvbkNhcmRBY3Rpb246IGNhcmRBY3Rpb24gPT4gcnVuTWlkZGxld2FyZSgoeyBjYXJkQWN0aW9uOiB7IHR5cGUgfSB9KSA9PiB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFdlYiBDaGF0OiByZWNlaXZlZCB1bmtub3duIGNhcmQgYWN0aW9uIFwiJHsgdHlwZSB9XCJgKTtcbiAgICB9KSh7XG4gICAgICBjYXJkQWN0aW9uLFxuICAgICAgZ2V0U2lnbkluVXJsOiBjYXJkQWN0aW9uLnR5cGUgPT09ICdzaWduaW4nID8gKCkgPT4ge1xuICAgICAgICBjb25zdCB7IHZhbHVlIH0gPSBjYXJkQWN0aW9uO1xuXG4gICAgICAgIGlmIChkaXJlY3RMaW5lLmdldFNlc3Npb25JZCkge1xuICAgICAgICAgIC8vIFRPRE86IFtQM10gV2Ugc2hvdWxkIGNoYW5nZSB0aGlzIG9uZSB0byBhc3luYy9hd2FpdC5cbiAgICAgICAgICAvLyAgICAgICBUaGlzIGlzIHRoZSBmaXJzdCBwbGFjZSBpbiB0aGlzIHByb2plY3QgdG8gdXNlIGFzeW5jLlxuICAgICAgICAgIC8vICAgICAgIFRodXMsIHdlIG5lZWQgdG8gYWRkIEBiYWJlbC9wbHVnaW4tdHJhbnNmb3JtLXJ1bnRpbWUgYW5kIEBiYWJlbC9ydW50aW1lLlxuXG4gICAgICAgICAgcmV0dXJuIG9ic2VydmFibGVUb1Byb21pc2UoZGlyZWN0TGluZS5nZXRTZXNzaW9uSWQoKSkudGhlbihzZXNzaW9uSWQgPT4gYCR7IHZhbHVlIH0keyBlbmNvZGVVUklDb21wb25lbnQoYCZjb2RlX2NoYWxsZW5nZT0keyBzZXNzaW9uSWQgfWApIH1gKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH0gOiBudWxsXG4gICAgfSlcbiAgfTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlRm9jdXNTZW5kQm94TG9naWMoeyBzZW5kQm94UmVmIH0pIHtcbiAgcmV0dXJuIHtcbiAgICBmb2N1c1NlbmRCb3g6ICgpID0+IHtcbiAgICAgIGNvbnN0IHsgY3VycmVudCB9ID0gc2VuZEJveFJlZiB8fCB7fTtcblxuICAgICAgY3VycmVudCAmJiBjdXJyZW50LmZvY3VzKCk7XG4gICAgfVxuICB9O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVTdHlsZVNldExvZ2ljKHsgc3R5bGVPcHRpb25zLCBzdHlsZVNldCB9KSB7XG4gIHJldHVybiB7XG4gICAgc3R5bGVTZXQ6IHN0eWxlU2V0VG9DbGFzc05hbWVzKHN0eWxlU2V0IHx8IGNyZWF0ZVN0eWxlU2V0KHN0eWxlT3B0aW9ucykpXG4gIH07XG59XG5cbi8vIFRPRE86IFtQM10gVGFrZSB0aGlzIGRlcHJlY2F0aW9uIGNvZGUgb3V0IHdoZW4gcmVsZWFzaW5nIG9uIG9yIGFmdGVyIDIwMTkgRGVjZW1iZXIgMTFcbmZ1bmN0aW9uIHBhdGNoUHJvcHNGb3JBdmF0YXJJbml0aWFscyh7IGJvdEF2YXRhckluaXRpYWxzLCB1c2VyQXZhdGFySW5pdGlhbHMsIC4uLnByb3BzIH0pIHtcbiAgLy8gVGhpcyBjb2RlIHdpbGwgdGFrZSBvdXQgXCJib3RBdmF0YXJJbml0aWFsc1wiIGFuZCBcInVzZXJBdmF0YXJJbml0aWFsc1wiIGZyb20gcHJvcHNcblxuICBsZXQgeyBzdHlsZU9wdGlvbnMgfSA9IHByb3BzO1xuXG4gIGlmIChib3RBdmF0YXJJbml0aWFscykge1xuICAgIHN0eWxlT3B0aW9ucyA9IHsgLi4uc3R5bGVPcHRpb25zLCBib3RBdmF0YXJJbml0aWFscyB9O1xuXG4gICAgY29uc29sZS53YXJuKCdXZWIgQ2hhdDogXCJib3RBdmF0YXJJbml0aWFsc1wiIGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgXCJzdHlsZU9wdGlvbnMuYm90QXZhdGFySW5pdGlhbHNcIiBpbnN0ZWFkLiBcImJvdEF2YXRhckluaXRpYWxzXCIgd2lsbCBiZSByZW1vdmVkIG9uIG9yIGFmdGVyIERlY2VtYmVyIDExIDIwMTkgLicpO1xuICB9XG5cbiAgaWYgKHVzZXJBdmF0YXJJbml0aWFscykge1xuICAgIHN0eWxlT3B0aW9ucyA9IHsgLi4uc3R5bGVPcHRpb25zLCB1c2VyQXZhdGFySW5pdGlhbHMgfTtcblxuICAgIGNvbnNvbGUud2FybignV2ViIENoYXQ6IFwiYm90QXZhdGFySW5pdGlhbHNcIiBpcyBkZXByZWNhdGVkLiBQbGVhc2UgdXNlIFwic3R5bGVPcHRpb25zLmJvdEF2YXRhckluaXRpYWxzXCIgaW5zdGVhZC4gXCJib3RBdmF0YXJJbml0aWFsc1wiIHdpbGwgYmUgcmVtb3ZlZCBvbiBvciBhZnRlciBEZWNlbWJlciAxMSAyMDE5IC4nKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgLi4ucHJvcHMsXG4gICAgc3R5bGVPcHRpb25zXG4gIH07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUxvZ2ljKHByb3BzKSB7XG4gIC8vIFRoaXMgaXMgYSBoZWF2eSBmdW5jdGlvbiwgYW5kIGl0IGlzIGV4cGVjdGVkIHRvIGJlIG9ubHkgY2FsbGVkIHdoZW4gdGhlcmUgaXMgYSBuZWVkIHRvIHJlY3JlYXRlIGJ1c2luZXNzIGxvZ2ljLCBlLmcuXG4gIC8vIC0gVXNlciBJRCBjaGFuZ2VkLCBjYXVzaW5nIGFsbCBzZW5kKiBmdW5jdGlvbnMgdG8gYmUgdXBkYXRlZFxuICAvLyAtIHNlbmRcblxuICAvLyBUT0RPOiBbUDRdIFdlIHNob3VsZCBicmVhayB0aGlzIGludG8gc21hbGxlciBwaWVjZXMgdXNpbmcgbWVtb2l6YXRpb24gZnVuY3Rpb24sIHNvIHdlIGRvbid0IHJlY3JlYXRlIHN0eWxlU2V0IGlmIHVzZXJJRCBpcyBjaGFuZ2VkXG5cbiAgLy8gVE9ETzogW1AzXSBXZSBzaG91bGQgdGhpbmsgYWJvdXQgaWYgd2UgYWxsb3cgdGhlIHVzZXIgdG8gY2hhbmdlIG9uU2VuZEJveFZhbHVlQ2hhbmdlZC9zZW5kQm94VmFsdWUsIGUuZy5cbiAgLy8gMS4gVHVybnMgdGV4dCBpbnRvIFVQUEVSQ0FTRVxuICAvLyAyLiBGaWx0ZXIgb3V0IHByb2Zhbml0eVxuXG4gIC8vIFRPRE86IFtQNF0gUmV2aXNpdCBhbGwgbWVtYmVycyBvZiBjb250ZXh0XG4gIHByb3BzID0gcGF0Y2hQcm9wc0ZvckF2YXRhckluaXRpYWxzKHByb3BzKTtcblxuICByZXR1cm4ge1xuICAgIC4uLnByb3BzLFxuICAgIC4uLmNyZWF0ZUNhcmRBY3Rpb25Mb2dpYyhwcm9wcyksXG4gICAgLi4uY3JlYXRlRm9jdXNTZW5kQm94TG9naWMocHJvcHMpLFxuICAgIC4uLmNyZWF0ZVN0eWxlU2V0TG9naWMocHJvcHMpXG4gIH07XG59XG5cbmNsYXNzIENvbXBvc2VyIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICB0aGlzLmNyZWF0ZUNvbnRleHRGcm9tUHJvcHMgPSBtZW1vaXplKFxuICAgICAgY3JlYXRlTG9naWMsXG4gICAgICBzaGFsbG93RXF1YWxzXG4gICAgKTtcblxuICAgIHRoaXMuY3JlYXRlV2ViU3BlZWNoUG9ueWZpbGwgPSBtZW1vaXplKCh3ZWJTcGVlY2hQb255ZmlsbEZhY3RvcnksIHJlZmVyZW5jZUdyYW1tYXJJRCkgPT4gd2ViU3BlZWNoUG9ueWZpbGxGYWN0b3J5ICYmIHdlYlNwZWVjaFBvbnlmaWxsRmFjdG9yeSh7IHJlZmVyZW5jZUdyYW1tYXJJRCB9KSk7XG5cbiAgICB0aGlzLm1lcmdlQ29udGV4dCA9IG1lbW9pemUoXG4gICAgICAoLi4uY29udGV4dHMpID0+IE9iamVjdC5hc3NpZ24oe30sIC4uLmNvbnRleHRzKSxcbiAgICAgIHNoYWxsb3dFcXVhbHNcbiAgICApO1xuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGhvaXN0ZWREaXNwYXRjaGVyczogbWFwTWFwKERJU1BBVENIRVJTLCBkaXNwYXRjaGVyID0+ICguLi5hcmdzKSA9PiB0aGlzLnByb3BzLmRpc3BhdGNoKGRpc3BhdGNoZXIuYXBwbHkodGhpcywgYXJncykpKVxuICAgIH07XG4gIH1cblxuICBjb21wb25lbnRXaWxsTW91bnQoKSB7XG4gICAgY29uc3QgeyBwcm9wcyB9ID0gdGhpcztcbiAgICBjb25zdCB7IGRpcmVjdExpbmUsIHVzZXJJRCwgdXNlcm5hbWUgfSA9IHByb3BzO1xuXG4gICAgdGhpcy5zZXRMYW5ndWFnZUZyb21Qcm9wcyhwcm9wcyk7XG4gICAgdGhpcy5zZXRTZW5kVGltZW91dEZyb21Qcm9wcyhwcm9wcyk7XG4gICAgdGhpcy5zZXRTZW5kVHlwaW5nSW5kaWNhdG9yRnJvbVByb3BzKHByb3BzKTtcblxuICAgIHByb3BzLmRpc3BhdGNoKGNyZWF0ZUNvbm5lY3RBY3Rpb24oeyBkaXJlY3RMaW5lLCB1c2VySUQsIHVzZXJuYW1lIH0pKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHtcbiAgICBjb25zdCB7IHByb3BzIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgZGlyZWN0TGluZSwgbG9jYWxlLCBzZW5kVGltZW91dCwgc2VuZFR5cGluZywgc2VuZFR5cGluZ0luZGljYXRvciwgdXNlcklELCB1c2VybmFtZSB9ID0gcHJvcHM7XG5cbiAgICBpZiAocHJldlByb3BzLmxvY2FsZSAhPT0gbG9jYWxlKSB7XG4gICAgICB0aGlzLnNldExhbmd1YWdlRnJvbVByb3BzKHByb3BzKTtcbiAgICB9XG5cbiAgICBpZiAocHJldlByb3BzLnNlbmRUaW1lb3V0ICE9PSBzZW5kVGltZW91dCkge1xuICAgICAgdGhpcy5zZXRTZW5kVGltZW91dEZyb21Qcm9wcyhwcm9wcyk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgIXByZXZQcm9wcy5zZW5kVHlwaW5nSW5kaWNhdG9yICE9PSAhc2VuZFR5cGluZ0luZGljYXRvclxuXG4gICAgICAvLyBUT0RPOiBbUDNdIFRha2UgdGhpcyBkZXByZWNhdGlvbiBjb2RlIG91dCB3aGVuIHJlbGVhc2luZyBvbiBvciBhZnRlciBKYW51YXJ5IDEzIDIwMjBcbiAgICAgIHx8ICFwcmV2UHJvcHMuc2VuZFR5cGluZyAhPT0gIXNlbmRUeXBpbmdcbiAgICApIHtcbiAgICAgIHRoaXMuc2V0U2VuZFR5cGluZ0luZGljYXRvckZyb21Qcm9wcyhwcm9wcyk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgcHJldlByb3BzLmRpcmVjdExpbmUgIT09IGRpcmVjdExpbmVcbiAgICAgIHx8IHByZXZQcm9wcy51c2VySUQgIT09IHVzZXJJRFxuICAgICAgfHwgcHJldlByb3BzLnVzZXJuYW1lICE9PSB1c2VybmFtZVxuICAgICkge1xuICAgICAgLy8gVE9ETzogW1AzXSBkaXNjb25uZWN0KCkgaXMgYW4gYXN5bmMgY2FsbCAocGVuZGluZyAtPiBmdWxmaWxsZWQpLCB3ZSBuZWVkIHRvIHdhaXQsIG9yIGNoYW5nZSBpdCB0byByZWNvbm5lY3QoKVxuICAgICAgcHJvcHMuZGlzcGF0Y2goZGlzY29ubmVjdCgpKTtcbiAgICAgIHByb3BzLmRpc3BhdGNoKGNyZWF0ZUNvbm5lY3RBY3Rpb24oeyBkaXJlY3RMaW5lLCB1c2VySUQsIHVzZXJuYW1lIH0pKTtcbiAgICB9XG4gIH1cblxuICBzZXRMYW5ndWFnZUZyb21Qcm9wcyhwcm9wcykge1xuICAgIHByb3BzLmRpc3BhdGNoKHNldExhbmd1YWdlKHByb3BzLmxvY2FsZSB8fCB3aW5kb3cubmF2aWdhdG9yLmxhbmd1YWdlIHx8ICdlbi1VUycpKTtcbiAgfVxuXG4gIHNldFNlbmRUaW1lb3V0RnJvbVByb3BzKHByb3BzKSB7XG4gICAgcHJvcHMuZGlzcGF0Y2goc2V0U2VuZFRpbWVvdXQocHJvcHMuc2VuZFRpbWVvdXQgfHwgMjAwMDApKTtcbiAgfVxuXG4gIHNldFNlbmRUeXBpbmdJbmRpY2F0b3JGcm9tUHJvcHMocHJvcHMpIHtcbiAgICBpZiAodHlwZW9mIHByb3BzLnNlbmRUeXBpbmcgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBwcm9wcy5kaXNwYXRjaChzZXRTZW5kVHlwaW5nSW5kaWNhdG9yKCEhcHJvcHMuc2VuZFR5cGluZ0luZGljYXRvcikpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBUT0RPOiBbUDNdIFRha2UgdGhpcyBkZXByZWNhdGlvbiBjb2RlIG91dCB3aGVuIHJlbGVhc2luZyBvbiBvciBhZnRlciBKYW51YXJ5IDEzIDIwMjBcbiAgICAgIGNvbnNvbGUud2FybignV2ViIENoYXQ6IFwic2VuZFR5cGluZ1wiIGhhcyBiZWVuIHJlbmFtZWQgdG8gXCJzZW5kVHlwaW5nSW5kaWNhdG9yXCIuIFBsZWFzZSB1c2UgXCJzZW5kVHlwaW5nSW5kaWNhdG9yXCIgaW5zdGVhZC4gVGhpcyBkZXByZWNhdGlvbiBtaWdyYXRpb24gd2lsbCBiZSByZW1vdmVkIG9uIG9yIGFmdGVyIEphbnVhcnkgMTMgMjAyMC4nKTtcbiAgICAgIHByb3BzLmRpc3BhdGNoKHNldFNlbmRUeXBpbmdJbmRpY2F0b3IoISFwcm9wcy5zZW5kVHlwaW5nKSk7XG4gICAgfVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIHByb3BzOiB7XG4gICAgICAgIGFjdGl2aXR5UmVuZGVyZXIsXG4gICAgICAgIGFkYXB0aXZlQ2FyZEhvc3RDb25maWcsXG4gICAgICAgIGF0dGFjaG1lbnRSZW5kZXJlcixcbiAgICAgICAgY2hpbGRyZW4sXG5cbiAgICAgICAgLy8gVE9ETzogW1AyXSBBZGQgZGlzYWJsZSBpbnRlcmFjdGl2aXR5XG4gICAgICAgIGRpc2FibGVkLFxuXG4gICAgICAgIGdyYW1tYXJzLFxuICAgICAgICBncm91cFRpbWVzdGFtcCxcbiAgICAgICAgcmVmZXJlbmNlR3JhbW1hcklELFxuICAgICAgICByZW5kZXJNYXJrZG93bixcbiAgICAgICAgc2Nyb2xsVG9FbmQsXG4gICAgICAgIHN0b3JlLFxuICAgICAgICB1c2VySUQsXG4gICAgICAgIHVzZXJuYW1lLFxuICAgICAgICB3ZWJTcGVlY2hQb255ZmlsbEZhY3RvcnksXG4gICAgICAgIC4uLnByb3BzRm9yTG9naWNcbiAgICAgIH0sXG4gICAgICBzdGF0ZVxuICAgIH0gPSB0aGlzO1xuXG4gICAgY29uc3QgY29udGV4dEZyb21Qcm9wcyA9IHRoaXMuY3JlYXRlQ29udGV4dEZyb21Qcm9wcyhwcm9wc0ZvckxvZ2ljKTtcblxuICAgIGNvbnN0IGNvbnRleHQgPSB0aGlzLm1lcmdlQ29udGV4dChcbiAgICAgIGNvbnRleHRGcm9tUHJvcHMsXG4gICAgICBzdGF0ZS5ob2lzdGVkRGlzcGF0Y2hlcnMsXG5cbiAgICAgIC8vIFRPRE86IFtQNF0gU2hvdWxkIHdlIG5vcm1hbGl6ZSBlbXB0aWVzIGhlcmU/IE9yIHNob3VsZCB3ZSBsZXQgaXQgdGhydT9cbiAgICAgIC8vICAgICAgIElmIHdlIGxldCBpdCB0aHJ1LCB0aGUgY29kZSBiZWxvdyBiZWNvbWUgc2ltcGxpZmllZCBhbmQgdGhlIHVzZXIgY2FuIHBsdWcgaW4gd2hhdGV2ZXIgdGhleSB3YW50IGZvciBjb250ZXh0LCB2aWEgQ29tcG9zZXIucHJvcHNcbiAgICAgIHtcbiAgICAgICAgYWN0aXZpdHlSZW5kZXJlcixcbiAgICAgICAgYWRhcHRpdmVDYXJkSG9zdENvbmZpZzogYWRhcHRpdmVDYXJkSG9zdENvbmZpZyB8fCBkZWZhdWx0QWRhcHRpdmVDYXJkSG9zdENvbmZpZyh0aGlzLnByb3BzLnN0eWxlT3B0aW9ucyksXG4gICAgICAgIGF0dGFjaG1lbnRSZW5kZXJlcixcblxuICAgICAgICBncm91cFRpbWVzdGFtcCxcbiAgICAgICAgZGlzYWJsZWQsXG4gICAgICAgIGdyYW1tYXJzOiBncmFtbWFycyB8fCBFTVBUWV9BUlJBWSxcbiAgICAgICAgcmVuZGVyTWFya2Rvd24sXG4gICAgICAgIHNjcm9sbFRvRW5kLFxuICAgICAgICBzdG9yZSxcbiAgICAgICAgd2ViU3BlZWNoUG9ueWZpbGw6IHRoaXMuY3JlYXRlV2ViU3BlZWNoUG9ueWZpbGwod2ViU3BlZWNoUG9ueWZpbGxGYWN0b3J5LCByZWZlcmVuY2VHcmFtbWFySUQpXG4gICAgICB9XG4gICAgKTtcblxuICAgIC8vIFRPRE86IFtQM10gQ2hlY2sgaG93IG1hbnkgdGltZXMgd2UgZG8gcmUtcmVuZGVyIGNvbnRleHRcblxuICAgIHJldHVybiAoXG4gICAgICA8Q29udGV4dC5Qcm92aWRlciB2YWx1ZT17IGNvbnRleHQgfT5cbiAgICAgICAgeyB0eXBlb2YgY2hpbGRyZW4gPT09ICdmdW5jdGlvbicgPyBjaGlsZHJlbihjb250ZXh0KSA6IGNoaWxkcmVuIH1cbiAgICAgICAgPERpY3RhdGlvbiAvPlxuICAgICAgPC9Db250ZXh0LlByb3ZpZGVyPlxuICAgICk7XG4gIH1cbn1cblxuY29uc3QgQ29ubmVjdGVkQ29tcG9zZXIgPSBjb25uZWN0KFxuICAoeyByZWZlcmVuY2VHcmFtbWFySUQgfSkgPT4gKHsgcmVmZXJlbmNlR3JhbW1hcklEIH0pXG4pKHByb3BzID0+XG4gIDxTY3JvbGxUb0JvdHRvbUNvbXBvc2VyPlxuICAgIDxTY3JvbGxUb0JvdHRvbUZ1bmN0aW9uQ29udGV4dC5Db25zdW1lcj5cbiAgICAgIHsgKHsgc2Nyb2xsVG9FbmQgfSkgPT5cbiAgICAgICAgPENvbXBvc2VyXG4gICAgICAgICAgc2Nyb2xsVG9FbmQ9eyBzY3JvbGxUb0VuZCB9XG4gICAgICAgICAgeyAuLi5wcm9wcyB9XG4gICAgICAgIC8+XG4gICAgICB9XG4gICAgPC9TY3JvbGxUb0JvdHRvbUZ1bmN0aW9uQ29udGV4dC5Db25zdW1lcj5cbiAgPC9TY3JvbGxUb0JvdHRvbUNvbXBvc2VyPlxuKTtcblxuLy8gV2Ugd2lsbCBjcmVhdGUgYSBSZWR1eCBzdG9yZSBpZiBpdCB3YXMgbm90IHBhc3NlZCBpblxuY2xhc3MgQ29ubmVjdGVkQ29tcG9zZXJXaXRoU3RvcmUgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIHRoaXMuY3JlYXRlTWVtb2l6ZWRTdG9yZSA9IG1lbW9pemUoKCkgPT4gY3JlYXRlU3RvcmUoKSk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBwcm9wcyB9ID0gdGhpcztcblxuICAgIHJldHVybiAoXG4gICAgICA8Q29ubmVjdGVkQ29tcG9zZXJcbiAgICAgICAgeyAuLi5wcm9wcyB9XG4gICAgICAgIHN0b3JlPXsgcHJvcHMuc3RvcmUgfHwgdGhpcy5jcmVhdGVNZW1vaXplZFN0b3JlKCkgfVxuICAgICAgLz5cbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IENvbm5lY3RlZENvbXBvc2VyV2l0aFN0b3JlXG5cbi8vIFRPRE86IFtQM10gV2Ugc2hvdWxkIGNvbnNpZGVyIG1vdmluZyBzb21lIHByb3BzIHRvIFJlZHV4IHN0b3JlXG4vLyAgICAgICBBbHRob3VnaCB3ZSB1c2UgYGNvbm5lY3RUb1dlYkNoYXRgIHRvIGhpZGUgdGhlIGRldGFpbHMgb2YgYWNjZXNzb3Igb2YgUmVkdXggc3RvcmUsXG4vLyAgICAgICB3ZSBzaG91bGQgY2xlYW4gdXAgdGhlIHJlc3BvbnNpYmlsaXR5IGJldHdlZW4gQ29udGV4dCBhbmQgUmVkdXggc3RvcmVcbi8vICAgICAgIFdlIHNob3VsZCBkZWNpZGUgd2hpY2ggZGF0YSBpcyBuZWVkZWQgZm9yIFJlYWN0IGJ1dCBub3QgaW4gb3RoZXIgZW52aXJvbm1lbnQgc3VjaCBhcyBDTEkvVlNDb2RlXG5Db25uZWN0ZWRDb21wb3NlcldpdGhTdG9yZS5wcm9wVHlwZXMgPSB7XG4gIGFjdGl2aXR5UmVuZGVyZXI6IFByb3BUeXBlcy5mdW5jLFxuICBhZGFwdGl2ZUNhcmRIb3N0Q29uZmlnOiBQcm9wVHlwZXMuYW55LFxuICBhdHRhY2htZW50UmVuZGVyZXI6IFByb3BUeXBlcy5mdW5jLFxuICBjYXJkQWN0aW9uTWlkZGxld2FyZTogUHJvcFR5cGVzLmZ1bmMsXG4gIGdyb3VwVGltZXN0YW1wOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuYm9vbCwgUHJvcFR5cGVzLm51bWJlcl0pLFxuICBkaXNhYmxlZDogUHJvcFR5cGVzLmJvb2wsXG4gIGdyYW1tYXJzOiBQcm9wVHlwZXMuYXJyYXlPZihQcm9wVHlwZXMuc3RyaW5nKSxcbiAgcmVuZGVyTWFya2Rvd246IFByb3BUeXBlcy5mdW5jLFxuICBzZW5kVGltZW91dDogUHJvcFR5cGVzLm51bWJlcixcbiAgc2VuZFR5cGluZ0luZGljYXRvcjogUHJvcFR5cGVzLmJvb2wsXG4gIHN0b3JlOiBQcm9wVHlwZXMuYW55LFxuICB1c2VySUQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHVzZXJuYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICB3ZWJTcGVlY2hQb255ZmlsbEZhY3Rvcnk6IFByb3BUeXBlcy5mdW5jXG59O1xuIl19